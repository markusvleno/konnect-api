(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{126:function(e,t,n){},128:function(e,t,n){},129:function(e,t,n){},130:function(e,t,n){},131:function(e,t,n){},132:function(e,t,n){},133:function(e,t,n){},134:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),s=n(28),i=n.n(s),o=n(2),c=n.n(o),u=n(18),l=n(3),d=n(4),f=n(5),p=n(11),v=n(7),h=n(8),C=(n(72),n(73),n(6)),m=n(63),g=n(33),b=n(32),j=function(e){if(!e)return" ";if(e<new Date(0))return" ";var t=new Date(Date.now()),n=new Date(e);return n.getTime()-t.getTime()<864e5?n.toLocaleTimeString().slice(0,-3):n.toLocaleDateString()},y=function(e){var t=localStorage.getItem(String(e));return t?JSON.parse(t)[0]:[]},w=n(17),O=n.n(w),x=Object(b.a)({name:"user",initialState:{userId:null,username:"",name:"",profilePicture:"/static/assets/images/profile.svg",conversation:[],signalProtocalManager:null,socket:null},reducers:{init:function(e,t){var n=t.payload;e.userId=n.userId,e.username=n.username,e.name=n.name,e.conversation=n.savedConv,e.signalProtocalManager=n.signalProtocalManager,e.socket=n.socket},updateName:function(e,t){e.name=t.payload.name},updateProfilePicture:function(e,t){e.profilePicture=t.payload.profilePicture},newConversation:function(e,t){e.conversation=Object(m.a)(Array,Object(g.a)(e.conversation).concat([t.payload.conv]))},newMessage:function(e,t){var n,r,a=t.payload,s=a.username,i=a.msgObj,o=null;e.conversation.forEach((function(e){e.username!==s||(o=e)})),o?e.conversation=e.conversation.map((function(e){return e.username===s?(e.chatLog=[].concat(Object(g.a)(e.chatLog),[i]),e):e})):O.a.get("/api/v1/user/?username=".concat(s)).then((function(t){if(200===t.status&&200===t.data.code){var n={username:t.data.data.username,userId:t.data.data.userId,name:t.data.data.name,chatLog:[i]};e.conversation=[n].concat(Object(g.a)(e.conversation))}})).catch((function(e){console.log(e)})),n=e.userId,r=e.conversation,n&&r&&(localStorage.removeItem(String(n)),localStorage.setItem(String(n),JSON.stringify([r])))},deleteConversation:function(e,t){t.payload.username;var n=e.conversation.forEach((function(e){return e.username,e}));e.conversation=new Array(n)}}}),k=x.actions,I=k.init,K=(k.updateName,k.updateProfilePicture,k.newConversation),S=(k.deleteConversation,k.newMessage),P=x.reducer,L=Object(b.a)({name:"UI",initialState:{convWindow:{isSelected:!1,selectedUserId:null},settingWindow:{isOpen:!1},newConversationWindow:{isOpen:!1}},reducers:{openConvWindow:function(e,t){var n=t.payload,r=n.userId,a=n.isSelected;r?e.convWindow={isSelected:a,selectedUserId:r}:e.convWindow.isSelected=!1},changeSettingWindow:function(e,t){var n=t.payload;e.settingWindow.isOpen="boolean"===typeof n&&n},chatNewConversationWindow:function(e,t){var n=t.payload.value;e.newConversationWindow.isOpen="boolean"===typeof n&&n}}}),N=L.actions,R=(N.changeSettingWindow,N.openConvWindow),M=N.chatNewConversationWindow,B=L.reducer,U=function(){var e=(new ArrayBuffer).__proto__;return{toString:function(e){return"string"==typeof e?e:new dcodeIO.ByteBuffer.wrap(e).toString("binary")},toArrayBuffer:function(t){if(void 0!==t){if(t===Object(t)&&t.__proto__==e)return t;if("string"!=typeof t)throw new Error("Tried to convert a non-string of type "+typeof t+" to an array buffer");return t,new dcodeIO.ByteBuffer.wrap(t,"binary").toArrayBuffer()}},isEqual:function(e,t){if(void 0===e||void 0===t)return!1;e=U.toString(e),t=U.toString(t);var n=Math.max(e.length,t.length);if(n<5)throw new Error("a/b compare too short");return e.substring(0,Math.min(n,e.length))==t.substring(0,Math.min(n,t.length))},arrayBufferToBase64:function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,a=0;a<r;a++)t+=String.fromCharCode(n[a]);return window.btoa(t)},base64ToArrayBuffer:function(e){for(var t=window.atob(e),n=t.length,r=new Uint8Array(n),a=0;a<n;a++)r[a]=t.charCodeAt(a);return r.buffer},getCookie:function(e){for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var r=t[n].trim().split("=");if(r[0]===e)return r[1]}}}}(),T=U,W=window.libsignal;function A(){this.store={}}A.prototype={Direction:{SENDING:1,RECEIVING:2},getIdentityKeyPair:function(){return Promise.resolve(this.get("identityKey"))},getLocalRegistrationId:function(){return Promise.resolve(this.get("registrationId"))},put:function(e,t){if(void 0===e||void 0===t||null===e||null===t)throw new Error("Tried to store undefined/null");this.store[e]=t},get:function(e,t){if(null===e||void 0===e)throw new Error("Tried to get value for undefined/null key");return e in this.store?this.store[e]:t},remove:function(e){if(null===e||void 0===e)throw new Error("Tried to remove value for undefined/null key");delete this.store[e]},isTrustedIdentity:function(e,t,n){if(null===e||void 0===e)throw new Error("tried to check identity key for undefined/null key");if(!(t instanceof ArrayBuffer))throw new Error("Expected identityKey to be an ArrayBuffer");var r=this.get("identityKey"+e);return void 0===r?Promise.resolve(!0):Promise.resolve(T.toString(t)===T.toString(r))},loadIdentityKey:function(e){if(null===e||void 0===e)throw new Error("Tried to get identity key for undefined/null key");return Promise.resolve(this.get("identityKey"+e))},saveIdentity:function(e,t){if(null===e||void 0===e)throw new Error("Tried to put identity key for undefined/null key");var n=new W.SignalProtocolAddress.fromString(e),r=this.get("identityKey"+n.getName());return this.put("identityKey"+n.getName(),t),r&&T.toString(t)!==T.toString(r)?Promise.resolve(!0):Promise.resolve(!1)},loadPreKey:function(e){var t=this.get("25519KeypreKey"+e);return void 0!==t&&(t={pubKey:t.pubKey,privKey:t.privKey}),Promise.resolve(t)},storePreKey:function(e,t){return Promise.resolve(this.put("25519KeypreKey"+e,t))},removePreKey:function(e){return Promise.resolve(this.remove("25519KeypreKey"+e))},loadSignedPreKey:function(e){var t=this.get("25519KeysignedKey"+e);return void 0!==t&&(t={pubKey:t.pubKey,privKey:t.privKey}),Promise.resolve(t)},storeSignedPreKey:function(e,t){return Promise.resolve(this.put("25519KeysignedKey"+e,t))},removeSignedPreKey:function(e){return Promise.resolve(this.remove("25519KeysignedKey"+e))},loadSession:function(e){return Promise.resolve(this.get("session"+e))},storeSession:function(e,t){return Promise.resolve(this.put("session"+e,t))},removeSession:function(e){return Promise.resolve(this.remove("session"+e))},removeAllSessions:function(e){for(var t in this.store)t.startsWith("session"+e)&&delete this.store[t];return Promise.resolve()},storeSessionCipher:function(e,t){this.put("cipher"+e,t)},loadSessionCipher:function(e){var t=this.get("cipher"+e);return void 0==t?null:t}};var E=A,V=window.libsignal,_=function(){function e(){Object(d.a)(this,e),this.bundleAPI=O.a.create({baseURL:"/api/v1/bundle",headers:{cookies:{_token:T.getCookie("_token")}}})}return Object(f.a)(e,[{key:"registerNewPreKeyBundle",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=Object(u.a)({},n)).identityKey=T.arrayBufferToBase64(r.identityKey),r.preKeys=r.preKeys.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{publicKey:T.arrayBufferToBase64(e.publicKey)})})),r.signedPreKey.publicKey=T.arrayBufferToBase64(r.signedPreKey.publicKey),r.signedPreKey.signature=T.arrayBufferToBase64(r.signedPreKey.signature),e.next=7,this.postBundle(t,JSON.stringify(r));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updatePreKeyBundle",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.postBundle(t,JSON.stringify(n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getPreKeyBundle",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.getBundle(t);case 3:return e.t1=e.sent,n=e.t0.parse.call(e.t0,e.t1),(r=n.preKeys.splice(-1))[0].publicKey=T.base64ToArrayBuffer(r[0].publicKey),this.updatePreKeyBundle(t,n),e.abrupt("return",{identityKey:T.base64ToArrayBuffer(n.identityKey),registrationId:n.registrationId,signedPreKey:{keyId:n.signedPreKey.keyId,publicKey:T.base64ToArrayBuffer(n.signedPreKey.publicKey),signature:T.base64ToArrayBuffer(n.signedPreKey.signature)},preKey:r[0]});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postBundle",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bundleAPI.post("/?id=".concat(t),{bundle:n}).then((function(e){200!==e.data.code&&console.log(e.data.message)})).catch((function(e){console.log(e)}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getBundle",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bundleAPI.get("/?id=".concat(t)).then((function(e){return 200!==e.status||200!==e.data.code?{}:e.data.bundle})).catch((function(e){return console.log(e),{}}));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Z=function(){function e(t,n){Object(d.a)(this,e),this.userId=t,this.store=new E,this.signalServerStore=n}return Object(f.a)(e,[{key:"initializeAsync",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._generateIdentityAsync();case 2:return e.next=4,this._generatePreKeyBundleAsync();case 4:t=e.sent,this.signalServerStore.registerNewPreKeyBundle(this.userId,t);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"encryptMessageAsync",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){var r,a,s,i,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(r=this.store.loadSessionCipher(t))){e.next=11;break}return a=new V.SignalProtocolAddress(t,123),s=new V.SessionBuilder(this.store,a),e.next=6,this.signalServerStore.getPreKeyBundle(t);case 6:return i=e.sent,e.next=9,s.processPreKey(i);case 9:r=new V.SessionCipher(this.store,a),this.store.storeSessionCipher(t,r);case 11:return e.next=13,r.encrypt(T.toArrayBuffer(n));case 13:return o=e.sent,e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"decryptMessageAsync",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){var r,a,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(r=this.store.loadSessionCipher(t))&&(a=new V.SignalProtocolAddress(t,123),r=new V.SessionCipher(this.store,a),this.store.storeSessionCipher(t,r)),!(3==n.type)){e.next=10;break}return e.next=6,r.decryptPreKeyWhisperMessage(n.body,"binary");case 6:return s=e.sent,e.abrupt("return",T.toString(s));case 10:return e.next=12,r.decryptWhisperMessage(n.body,"binary");case 12:return s=e.sent,e.abrupt("return",T.toString(s));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_generateIdentityAsync",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([V.KeyHelper.generateIdentityKeyPair(),V.KeyHelper.generateRegistrationId()]);case 2:t=e.sent,this.store.put("identityKey",t[0]),this.store.put("registrationId",t[1]);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_generatePreKeyBundleAsync",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n,r,a,s,i,o,u=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.store.getIdentityKeyPair(),this.store.getLocalRegistrationId()]);case 2:return t=e.sent,n=t[0],r=t[1],e.next=7,Promise.all([V.KeyHelper.generatePreKey(r+1),V.KeyHelper.generatePreKey(r+2),V.KeyHelper.generatePreKey(r+3),V.KeyHelper.generatePreKey(r+4),V.KeyHelper.generateSignedPreKey(n,r+1)]);case 7:return a=e.sent,s=[a[0],a[1],a[2],a[3]],i=a[4],s.forEach((function(e){u.store.storePreKey(e.keyId,e.keyPair)})),this.store.storeSignedPreKey(i.keyId,i.keyPair),o=s.map((function(e){return{keyId:e.keyId,publicKey:e.keyPair.pubKey}})),e.abrupt("return",{identityKey:n.pubKey,registrationId:r,preKeys:o,signedPreKey:{keyId:i.keyId,publicKey:i.keyPair.pubKey,signature:i.signature}});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function H(e,t){return D.apply(this,arguments)}function D(){return(D=Object(l.a)(c.a.mark((function e(t,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Z(t,n),e.next=3,Promise.all([r.initializeAsync()]);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var F=n(64),J=(n(126),n(0)),z=function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){return Object(J.jsx)(a.a.Fragment,{children:Object(J.jsxs)("span",{className:"logo",children:["K",Object(J.jsxs)("svg",{width:"201",height:"203",viewBox:"0 0 201 203",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(J.jsx)("path",{d:"M73.7759 81.6424C79.6796 81.6424 84.4655 76.7902 84.4655 70.8047C84.4655 64.8191 79.6796 59.9669 73.7759 59.9669C67.8722 59.9669 63.0863 64.8191 63.0863 70.8047C63.0863 76.7902 67.8722 81.6424 73.7759 81.6424Z",fill:"white"}),Object(J.jsx)("path",{d:"M74.1497 112.989C80.0534 112.989 84.8393 108.136 84.8393 102.151C84.8393 96.1653 80.0534 91.313 74.1497 91.313C68.2459 91.313 63.46 96.1653 63.46 102.151C63.46 108.136 68.2459 112.989 74.1497 112.989Z",fill:"white"}),Object(J.jsx)("path",{d:"M73.7759 144.335C79.6796 144.335 84.4655 139.482 84.4655 133.497C84.4655 127.511 79.6796 122.659 73.7759 122.659C67.8722 122.659 63.0863 127.511 63.0863 133.497C63.0863 139.482 67.8722 144.335 73.7759 144.335Z",fill:"white"}),Object(J.jsx)("path",{d:"M136.866 62.6722L136.861 62.6671C132.353 58.5919 125.439 58.9936 121.42 63.5643L94.8349 93.7948C90.8154 98.3655 91.2115 105.374 95.7198 109.45L95.7254 109.455C100.234 113.53 107.147 113.128 111.166 108.558L137.751 78.3271C141.771 73.7564 141.375 66.7474 136.866 62.6722Z",fill:"white"}),Object(J.jsx)("path",{d:"M136.444 141.723L136.45 141.718C140.987 137.676 141.434 130.67 137.448 126.07L110.406 94.8627C106.42 90.2623 99.5098 89.8092 94.9722 93.8508L94.9666 93.8558C90.429 97.8974 89.9821 104.903 93.9685 109.504L121.01 140.711C124.996 145.311 131.907 145.765 136.444 141.723Z",fill:"white"}),Object(J.jsx)("path",{d:"M162.014 164.047C149.368 176.873 133.142 185.452 115.531 188.624C97.9189 191.796 79.7714 189.407 63.5423 181.782C58.7656 179.834 27.8927 188.504 21.1948 181.721C14.497 174.938 23.0487 143.615 21.1276 138.779C14.4017 124.104 11.7738 107.839 13.5299 91.7551C15.2859 75.6709 21.3586 60.3828 31.0873 47.5539C40.816 34.7249 53.8283 24.8462 68.7087 18.9925C83.5891 13.1388 99.7679 11.534 115.485 14.3529C131.202 17.1718 145.856 24.3063 157.853 34.9805C169.85 45.6546 178.73 59.4596 183.527 74.8938C188.324 90.328 188.855 106.8 185.062 122.519C181.269 138.238 173.298 152.602 162.014 164.047V164.047Z",stroke:"white",strokeWidth:"25",strokeLinecap:"round",strokeLinejoin:"round"})]}),"NNECT"]})})}}]),n}(a.a.Component),X=(n(128),n(129),function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).getUsername=r.getUsername.bind(Object(p.a)(r)),r}return Object(f.a)(n,[{key:"getUsername",value:function(){var e=this,t="";return this.props.user.conversation.forEach((function(n){n.userId===e.props.UI.convWindow.selectedUserId&&(t=n.username)})),t}},{key:"render",value:function(){return this.props.UI.convWindow.isSelected?Object(J.jsxs)("div",{className:"user-detail user-detail-show",children:[Object(J.jsx)("img",{src:"/static/assets/images/profile.svg",alt:" "}),Object(J.jsx)("span",{children:this.getUsername()})]}):Object(J.jsx)("div",{className:"user-detail user-detail-hidden"})}}]),n}(a.a.PureComponent)),q=Object(C.b)((function(e){return{user:e.user,UI:e.UI}}),{})(X),G=function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e=this;return Object(J.jsxs)("div",{className:"option",children:[Object(J.jsx)(q,{}),Object(J.jsxs)("div",{className:"controls",children:[Object(J.jsx)("div",{className:"control-svg tab-conversation",onClick:function(t){t.preventDefault(),e.props.openConvWindow({userId:null,isSelected:!1})},children:Object(J.jsx)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Object(J.jsxs)("g",{children:[Object(J.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M28.5214 104.252C31.7989 104.252 34.8143 105.481 38.0509 106.784C49.0586 112.002 61.5574 113.16 73.3364 110.052C85.1154 106.944 95.4157 99.7705 102.415 89.8005C109.415 79.8305 112.663 67.7064 111.584 55.5728C110.506 43.4391 105.171 32.0778 96.5224 23.4984C91.7285 18.7022 86.0365 14.8975 79.7717 12.3016C73.5068 9.70579 66.7919 8.36971 60.0105 8.36971C53.229 8.36971 46.5141 9.70579 40.2492 12.3016C33.9844 14.8975 28.2924 18.7022 23.4985 23.4984C16.0361 30.9984 11.0459 40.6011 9.19757 51.0182C7.34924 61.4353 8.73114 72.1685 13.1579 81.7778C14.4607 85.006 15.7226 88.1604 15.7226 91.4296C15.7226 94.6987 14.6 97.9842 13.6167 100.885C12.7973 103.277 11.5683 106.882 12.3549 107.669C13.1415 108.455 16.7632 107.21 19.1558 106.391C22.0318 105.407 25.293 104.277 28.5214 104.252ZM59.8712 119.992C51.1873 119.998 42.6062 118.114 34.7242 114.469C32.3561 113.519 30.1438 112.626 28.5542 112.626C26.7187 112.626 24.2606 113.486 21.8843 114.305C16.968 115.944 10.9291 118.074 6.4307 113.593C1.93226 109.111 4.0217 103.056 5.68505 98.1809C6.50444 95.7802 7.32383 93.2649 7.32383 91.4296C7.32383 89.8892 6.58638 87.9228 5.44743 85.0961C0.352134 73.9481 -1.21843 61.5105 0.945705 49.446C3.10984 37.3814 8.90555 26.265 17.558 17.5828C24.5388 10.5993 33.1354 5.44655 42.5851 2.58145C52.0348 -0.283645 62.0456 -0.772484 71.7295 1.15829C81.4134 3.08907 90.4712 7.37978 98.0993 13.6498C105.727 19.9199 111.69 27.9755 115.459 37.1021C119.227 46.2288 120.685 56.1443 119.702 65.9692C118.72 75.7942 115.328 85.2249 109.827 93.4248C104.326 101.625 96.8863 108.34 88.1677 112.976C79.4491 117.612 69.7211 120.024 59.8466 120L59.8712 119.992Z",fill:"white"}),Object(J.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M82.0438 67.9064C80.5994 67.8578 79.2299 67.2515 78.223 66.2147C77.216 65.178 76.65 63.7915 76.6436 62.3463C76.6372 60.9011 77.1911 59.5096 78.1888 58.4641C79.1866 57.4185 80.5507 56.8002 81.9947 56.7388H82.0438C82.7952 56.7101 83.5445 56.8332 84.2472 57.1008C84.9498 57.3685 85.5911 57.7751 86.1329 58.2965C86.6746 58.8178 87.1055 59.4431 87.3999 60.1349C87.6943 60.8267 87.846 61.5708 87.846 62.3226C87.846 63.0744 87.6943 63.8185 87.3999 64.5103C87.1055 65.2021 86.6746 65.8274 86.1329 66.3488C85.5911 66.8701 84.9498 67.2768 84.2472 67.5444C83.5445 67.8121 82.7952 67.9352 82.0438 67.9064V67.9064Z",fill:"white"}),Object(J.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M59.6663 67.9064C58.2218 67.8578 56.8523 67.2515 55.8454 66.2148C54.8385 65.178 54.2724 63.7915 54.266 62.3463C54.2597 60.9011 54.8135 59.5097 55.8113 58.4641C56.809 57.4186 58.1731 56.8002 59.6171 56.7389H59.6663C61.1103 56.7942 62.4767 57.4067 63.4787 58.4478C64.4808 59.4889 65.0406 60.8777 65.0406 62.3227C65.0406 63.7676 64.4808 65.1564 63.4787 66.1975C62.4767 67.2386 61.1103 67.8511 59.6663 67.9064V67.9064Z",fill:"white"}),Object(J.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M37.289 67.9064C35.8445 67.8578 34.475 67.2515 33.4681 66.2148C32.4612 65.178 31.8951 63.7915 31.8887 62.3463C31.8824 60.9011 32.4362 59.5097 33.434 58.4641C34.4317 57.4186 35.7958 56.8002 37.2398 56.7389H37.289C38.7329 56.7942 40.0994 57.4067 41.1014 58.4478C42.1035 59.4889 42.6632 60.8777 42.6632 62.3227C42.6632 63.7676 42.1035 65.1564 41.1014 66.1975C40.0994 67.2386 38.7329 67.8511 37.289 67.9064Z",fill:"white"})]})})}),Object(J.jsx)("div",{className:"control-svg tab-add",onClick:function(t){t.preventDefault(),e.props.chatNewConversationWindow({value:!0})},children:Object(J.jsxs)("svg",{width:"121",height:"120",viewBox:"0 0 121 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(J.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M47.2605 84.6071C21.8784 84.6071 9.00161 89.0151 9.00161 97.6938C9.00161 106.372 21.9187 110.91 47.2605 110.91C72.6023 110.91 85.5274 106.502 85.5274 97.8229C85.5274 89.1442 72.6588 84.6071 47.2605 84.6071ZM47.2605 120C35.5705 120 0 120 0 97.6857C0 77.8095 26.9726 75.5086 47.2605 75.5086C58.9505 75.5086 94.521 75.5086 94.521 97.8229C94.521 117.707 67.5565 120 47.2605 120Z",fill:"white"}),Object(J.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M47.2605 9.09043C42.7172 9.1603 38.2939 10.5599 34.5374 13.1162C30.7808 15.6725 27.8556 19.2736 26.1233 23.4743C24.391 27.6749 23.9275 32.2911 24.7901 36.7524C25.6526 41.2136 27.8035 45.3243 30.9769 48.5764C33.0798 50.7283 35.5912 52.4387 38.3638 53.6074C41.1364 54.776 44.1144 55.3794 47.1233 55.3821L47.2847 59.9354V55.3821C53.4234 55.3821 59.3106 52.9436 63.6513 48.6029C67.992 44.2622 70.4306 38.3749 70.4306 32.2363C70.4306 26.0976 67.992 20.2104 63.6513 15.8697C59.3106 11.529 53.4234 9.09043 47.2847 9.09043H47.2605ZM47.2605 64.4806H47.0748C42.8852 64.4731 38.7393 63.6295 34.8799 61.9992C31.0205 60.3689 27.5253 57.9848 24.599 54.9865C18.6181 48.9243 15.2876 40.7361 15.3391 32.2201C15.4155 25.9266 17.3517 19.7962 20.904 14.6005C24.4563 9.40477 29.466 5.37577 35.3027 3.02048C41.1394 0.665203 47.5424 0.0888718 53.7059 1.36401C59.8694 2.63915 65.518 5.70879 69.941 10.1867C74.3641 14.6646 77.3639 20.3506 78.5629 26.5293C79.762 32.7081 79.1068 39.1034 76.6798 44.9107C74.2527 50.7179 70.1623 55.6776 64.9232 59.1656C59.684 62.6536 53.5303 64.5141 47.2363 64.5129L47.2605 64.4806Z",fill:"white"}),Object(J.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M103.224 69.2923C102.024 69.2837 100.877 68.7995 100.034 67.9458C99.1906 67.0921 98.7207 65.9388 98.7271 64.739V40.4306C98.7271 39.238 99.2009 38.0942 100.044 37.2509C100.887 36.4076 102.031 35.9338 103.224 35.9338C104.417 35.9338 105.56 36.4076 106.404 37.2509C107.247 38.0942 107.721 39.238 107.721 40.4306V64.739C107.727 65.9388 107.257 67.0921 106.414 67.9458C105.571 68.7995 104.424 69.2837 103.224 69.2923Z",fill:"white"}),Object(J.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M115.503 57.126H90.9607C89.7552 57.126 88.5991 56.6471 87.7468 55.7947C86.8944 54.9423 86.4155 53.7862 86.4155 52.5807C86.4155 51.3753 86.8944 50.2192 87.7468 49.3668C88.5991 48.5144 89.7552 48.0355 90.9607 48.0355H115.503C116.709 48.0355 117.865 48.5144 118.717 49.3668C119.57 50.2192 120.048 51.3753 120.048 52.5807C120.048 53.7862 119.57 54.9423 118.717 55.7947C117.865 56.6471 116.709 57.126 115.503 57.126V57.126Z",fill:"white"})]})}),Object(J.jsx)("div",{className:"control-svg tab-settings",children:Object(J.jsxs)("svg",{width:"121",height:"120",viewBox:"0 0 121 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(J.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M33.3752 89.4131C34.8075 89.4121 36.2345 89.5861 37.6245 89.9311C41.768 90.9421 45.3573 93.5217 47.6367 97.1265C49.0518 99.3397 49.8174 101.906 49.8463 104.532C49.8756 105.454 50.0863 106.36 50.4664 107.2C50.8465 108.04 51.3885 108.796 52.0614 109.426C52.7342 110.056 53.5248 110.548 54.3877 110.872C55.2507 111.196 56.1691 111.346 57.0903 111.315H64.8847C68.8588 111.315 72.1126 108.32 72.1288 104.621C72.1308 102.566 72.564 100.533 73.4005 98.6551C74.2371 96.7772 75.4582 95.0956 76.9851 93.719C80.181 90.7629 84.3926 89.1513 88.7455 89.2188C91.5283 89.2746 94.2602 89.9756 96.7261 91.2666C98.3817 92.1632 100.312 92.4113 102.14 91.9624C103.969 91.5135 105.565 90.3998 106.617 88.8384L110.753 82.428C111.21 81.6825 111.509 80.8503 111.628 79.9838C111.748 79.1173 111.687 78.2353 111.449 77.3936C111.188 76.5299 110.757 75.727 110.182 75.0321C109.606 74.3371 108.898 73.7641 108.098 73.3467C106.236 72.3863 104.588 71.0574 103.255 69.4406C101.922 67.8238 100.932 65.9529 100.344 63.9416C99.7934 61.9821 99.6594 59.929 99.9508 57.9145C100.242 55.9001 100.952 53.9691 102.036 52.2459C103.52 49.8777 105.603 47.9429 108.074 46.6368C108.869 46.2327 109.572 45.6687 110.139 44.9801C110.706 44.2915 111.124 43.4932 111.368 42.6352C111.612 41.7773 111.676 40.8782 111.557 39.9943C111.437 39.1104 111.135 38.2609 110.672 37.4988C110.586 37.3712 110.513 37.2357 110.453 37.0942L106.803 31.2099C105.764 29.6406 104.176 28.5165 102.35 28.0582C100.525 27.6 98.5937 27.8407 96.9365 28.7332C93.1244 30.8124 88.6722 31.3899 84.4558 30.3519C80.288 29.3922 76.6636 26.8345 74.3627 23.2293C72.9313 21.0073 72.1569 18.426 72.1288 15.7829C72.1662 14.8415 72.0029 13.9029 71.6499 13.0293C71.2968 12.1558 70.762 11.3673 70.081 10.7162C68.6718 9.40049 66.8127 8.67365 64.8847 8.6846H57.0903C55.2034 8.67343 53.3819 9.37599 51.9912 10.6514C51.3345 11.251 50.8102 11.9812 50.452 12.7952C50.0938 13.6091 49.9096 14.489 49.9111 15.3782C49.7816 23.8687 42.3433 30.6838 33.3752 30.6838C30.5448 30.6698 27.7627 29.9493 25.2814 28.5875C23.624 27.7179 21.7028 27.4948 19.8902 27.9614C18.0777 28.428 16.503 29.551 15.4716 31.1128L11.2627 37.5879C10.8157 38.3522 10.5303 39.2001 10.4239 40.0791C10.3176 40.9581 10.3927 41.8496 10.6445 42.6985C10.8964 43.5473 11.3197 44.3355 11.8882 45.0143C12.4567 45.6931 13.1584 46.2481 13.9499 46.6449C16.4369 47.8791 18.5298 49.7832 19.993 52.1427C21.4562 54.5023 22.2314 57.2235 22.2314 59.9999C22.2314 62.7762 21.4562 65.4974 19.993 67.857C18.5298 70.2165 16.4369 72.1206 13.9499 73.3548C13.1556 73.7576 12.453 74.3199 11.8859 75.0066C11.3188 75.6933 10.8995 76.4896 10.6541 77.3457C10.4087 78.2019 10.3426 79.0994 10.4599 79.9822C10.5771 80.865 10.8753 81.7142 11.3356 82.4766L15.2611 88.7736C16.2322 90.3917 17.7933 91.5698 19.6156 92.0597C21.4669 92.5429 23.4311 92.3298 25.1357 91.4608C27.6703 90.1065 30.5015 89.4029 33.3752 89.4131V89.4131ZM64.8928 120H57.0903C47.9523 120 40.5141 113.08 40.5141 104.573C40.4881 103.481 40.1634 102.417 39.5752 101.497C38.5864 99.9063 37.015 98.7648 35.1964 98.3163C33.3638 97.8707 31.4315 98.1126 29.7654 98.9962C25.8481 101.016 21.3238 101.52 17.058 100.413C12.9142 99.3515 9.34467 96.7223 7.10248 93.0796L3.20932 86.8392C-1.33945 79.4818 1.372 70.0687 9.24736 65.8355C10.3465 65.3071 11.274 64.479 11.9232 63.4466C12.5724 62.4142 12.9168 61.2194 12.9168 59.9999C12.9168 58.7803 12.5724 57.5855 11.9232 56.5531C11.274 55.5207 10.3465 54.6926 9.24736 54.1642C1.36391 49.8987 -1.33945 40.4693 3.20122 33.1281L7.42623 26.653C11.9102 19.4252 22.0438 16.8594 29.9596 21.0844C31.0041 21.6684 32.1787 21.9802 33.3752 21.991C37.2522 21.991 40.4979 19.0205 40.5626 15.354C40.5701 13.3135 41.0022 11.297 41.8313 9.43254C42.6604 7.56811 43.8684 5.89662 45.3785 4.52434C48.565 1.58168 52.7531 -0.0362378 57.0903 -0.000141172H64.8847C69.2974 -0.0181372 73.5503 1.64946 76.7747 4.66194C78.2953 6.09747 79.4976 7.83639 80.3034 9.76608C81.1093 11.6958 81.501 13.7732 81.4529 15.8639C81.5012 16.914 81.825 17.9328 82.3918 18.8182C83.4005 20.3879 84.979 21.505 86.7949 21.9343C88.634 22.3706 90.5693 22.1172 92.234 21.222C100.198 16.9889 110.34 19.5223 114.897 26.8878L118.774 33.1362C118.871 33.2948 118.958 33.4597 119.033 33.63C123.153 40.9145 120.401 49.9958 112.744 54.1561C111.667 54.7179 110.759 55.5559 110.113 56.5842C109.637 57.3353 109.324 58.178 109.194 59.0578C109.065 59.9377 109.121 60.835 109.361 61.6915C109.62 62.5573 110.051 63.362 110.628 64.0573C111.205 64.7527 111.916 65.3245 112.72 65.7384C114.565 66.7067 116.199 68.0338 117.525 69.6419C118.851 71.25 119.842 73.1067 120.441 75.1031C120.994 77.0632 121.13 79.1175 120.84 81.1334C120.55 83.1493 119.841 85.082 118.758 86.8068L114.63 93.2091C110.081 100.494 99.9394 103.003 92.0559 98.7615C90.9827 98.1998 89.7947 97.8924 88.5837 97.8631V97.8631C86.7341 97.876 84.9549 98.5738 83.5897 99.8218C82.929 100.424 82.4013 101.158 82.0403 101.976C81.6793 102.794 81.4931 103.679 81.4934 104.573C81.4206 113.12 73.9823 120 64.8847 120H64.8928Z",fill:"white"}),Object(J.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M61.0162 49.0733C54.5411 49.0733 49.28 53.9782 49.28 60C49.28 66.0219 54.5411 70.9187 61.0162 70.9187C67.4913 70.9187 72.7523 66.0219 72.7523 60C72.7523 53.9782 67.4832 49.0733 61.0162 49.0733ZM61.0162 79.6034C49.4015 79.6034 39.9721 70.8134 39.9721 60C39.9721 49.1866 49.4015 40.3885 61.0162 40.3885C72.6309 40.3885 82.0603 49.1866 82.0603 60C82.0603 70.8134 72.6309 79.6034 61.0162 79.6034Z",fill:"white"})]})}),Object(J.jsx)("div",{className:"control-svg tab-logout",onClick:function(e){e.preventDefault()},children:Object(J.jsxs)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(J.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M54.4506 120H25.9001C19.0308 119.992 12.4456 117.363 7.58979 112.692C2.73401 108.021 0.00438233 101.689 0 95.0848L0 32.5699C0.0065704 25.9667 2.7369 19.6355 7.59221 14.9648C12.4475 10.2941 19.0314 7.66523 25.9001 7.65469H54.3843C61.2623 7.65258 67.8598 10.2756 72.7272 14.9474C77.5946 19.6193 80.3336 25.9577 80.3424 32.5699V37.8093C80.2932 38.8958 79.8097 39.9222 78.9926 40.6743C78.1755 41.4264 77.0879 41.8463 75.9567 41.8463C74.8254 41.8463 73.7378 41.4264 72.9207 40.6743C72.1036 39.9222 71.6201 38.8958 71.571 37.8093V32.5699C71.5688 30.4022 71.1225 28.2562 70.2576 26.2543C69.3927 24.2524 68.1262 22.4339 66.5302 20.9026C64.9343 19.3713 63.0403 18.1572 60.9563 17.3296C58.8723 16.502 56.6391 16.0771 54.3843 16.0792H25.9001C21.3549 16.0876 16.9986 17.8282 13.7862 20.9195C10.5739 24.0107 8.76749 28.2003 8.76311 32.5699V95.0848C8.76749 99.4544 10.5739 103.644 13.7862 106.735C16.9986 109.826 21.3549 111.567 25.9001 111.575H54.4506C58.9804 111.569 63.3228 109.836 66.5258 106.757C69.7289 103.678 71.5313 99.5033 71.5378 95.1485V89.8533C71.587 88.7668 72.0705 87.7405 72.8876 86.9884C73.7047 86.2362 74.7923 85.8164 75.9235 85.8164C77.0548 85.8164 78.1424 86.2362 78.9595 86.9884C79.7766 87.7405 80.2601 88.7668 80.3092 89.8533V95.1485C80.3005 101.738 77.573 108.056 72.7252 112.715C67.8774 117.374 61.3053 119.994 54.4506 120V120Z",fill:"white"}),Object(J.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M115.618 68.0436H45.2568C44.1266 67.9964 43.059 67.5315 42.2766 66.746C41.4943 65.9605 41.0576 64.9149 41.0576 63.8274C41.0576 62.7398 41.4943 61.6943 42.2766 60.9087C43.059 60.1232 44.1266 59.6583 45.2568 59.6111H115.66C116.79 59.6583 117.858 60.1232 118.64 60.9087C119.422 61.6943 119.859 62.7398 119.859 63.8274C119.859 64.9149 119.422 65.9605 118.64 66.746C117.858 67.5315 116.79 67.9964 115.66 68.0436H115.618Z",fill:"white"}),Object(J.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M98.5063 84.4228C97.6474 84.4128 96.8104 84.1607 96.099 83.6978C95.3876 83.2349 94.8332 82.5816 94.5043 81.8187C94.1754 81.0558 94.0866 80.2169 94.2488 79.4059C94.411 78.595 94.8171 77.8476 95.4169 77.2564L109.406 63.8552L95.4169 50.4381C94.6485 49.64 94.2309 48.5871 94.2516 47.4997C94.2723 46.4124 94.7297 45.3749 95.528 44.6043C96.3263 43.8338 97.4037 43.3899 98.5346 43.3656C99.6656 43.3414 100.763 43.7386 101.596 44.4741L118.708 60.8453C119.117 61.2361 119.441 61.7007 119.663 62.2125C119.884 62.7242 119.998 63.2731 119.998 63.8273C119.998 64.3816 119.884 64.9305 119.663 65.4422C119.441 65.954 119.117 66.4186 118.708 66.8094L101.596 83.1886C101.191 83.5799 100.709 83.8903 100.179 84.1021C99.649 84.314 99.0805 84.4229 98.5063 84.4228V84.4228Z",fill:"white"})]})})]}),Object(J.jsx)("div",{className:"me-photo",children:Object(J.jsx)("img",{src:"/static/assets/images/profile.svg",height:"40px",width:"40px",alt:"profile",style:{display:"flex",margin:"auto"}})})]})}}]),n}(a.a.Component),$=Object(C.b)((function(e){return{user:e.user,UI:e.UI}}),{chatNewConversationWindow:M,openConvWindow:R})(G),Q=(n(130),function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){return Object(J.jsxs)("div",{className:"search",children:[Object(J.jsx)("div",{className:"search-logo",children:Object(J.jsxs)("svg",{width:"121",height:"121",viewBox:"0 0 121 121",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(J.jsx)("circle",{cx:"50",cy:"50",r:"45",stroke:"#FFF8F8",strokeWidth:"10"}),Object(J.jsx)("rect",{x:"112.549",y:"120.785",width:"47.5392",height:"10.9338",transform:"rotate(-135 112.549 120.785)",fill:"white"})]})}),Object(J.jsx)("input",{type:"text",placeholder:"Search",onKeyPress:function(e){console.log(e)}})]})}}]),n}(a.a.Component)),Y=(n(131),function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).getLastMsg=function(e){var t=e[e.length-1];return t.data.length>20?t.data.substring(.2)+"...":t.data},a.makeConversationList=function(){return a.props.user.conversation.map((function(e){return Object(J.jsxs)("li",{onClick:function(t){t.preventDefault(),a.props.openConvWindow({isSelected:!0,userId:e.userId})},children:[Object(J.jsx)("img",{src:"/static/assets/images/profile.svg",height:"40px",width:"40px",alt:"profile",className:"profile"}),Object(J.jsx)("div",{className:"name",children:e.username}),Object(J.jsx)("div",{className:"lastMsg",children:e.chatLog.length>0?a.getLastMsg(e.chatLog):""}),Object(J.jsx)("div",{className:"lastMsgTime",children:e.chatLog.length>0?j(e.chatLog[0].time):""})]},e.userId)}))},a.convList=Object(r.createRef)(),a}return Object(f.a)(n,[{key:"render",value:function(){return Object(J.jsx)(J.Fragment,{children:Object(J.jsx)("div",{className:"users",children:Object(J.jsx)("ul",{className:"users-list",children:this.makeConversationList()})})})}}]),n}(a.a.PureComponent)),ee=Object(C.b)((function(e){return{user:e.user,UI:e.UI}}),{openConvWindow:R})(Y),te=n(65),ne=(n(132),n(135));var re=function(){var e=Object(C.d)((function(e){return e.user})),t=e.signalProtocalManager,n=e.socket,s=e.username,i=e.userId,o=Object(C.d)((function(e){return e.UI.convWindow})).selectedUserId,u=Object(C.d)((function(e){var t=[];return e.user.conversation.forEach((function(n){n.userId!==e.UI.convWindow.selectedUserId||(t=n)})),t})),d=Object(r.useState)(""),f=Object(te.a)(d,2),p=f[0],v=f[1],h=Object(C.c)(),m=Object(r.useRef)(null);Object(r.useEffect)((function(){m.current.scrollTop=9999999})),Object(r.useEffect)((function(){v("")}),[o]);var g=function(){var e=Object(l.a)(c.a.mark((function e(){var r,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.encryptMessageAsync(u.userId,p);case 3:r=e.sent,a={data:r,type:"msg/text",time:Date.now(),receiver:{username:u.username,userId:u.userId},sender:{username:s,userId:i}},n.emit("send-message",{_msgToSend:a},(function(e){if(e){var t={data:p,type:a.type,time:a.time,origin:!0,msgId:Object(ne.a)()};h(S({username:a.receiver.username,msgObj:t})),v("")}})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),b=function(){var e=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=t.target.value.trimStart()).length<=0||n.length>256)){e.next=4;break}return v(""),e.abrupt("return");case 4:v(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(J.jsx)(a.a.Fragment,{children:Object(J.jsxs)("div",{className:"conversation",children:[Object(J.jsx)("div",{className:"messageList",children:Object(J.jsx)("ul",{className:"msgList",ref:m,children:function(){var e=u.chatLog;return!e||e.length<=0?Object(J.jsx)(J.Fragment,{}):e.map((function(e){return Object(J.jsx)("li",{className:"messageWrap",children:Object(J.jsxs)("div",{className:e.origin?"messageBox self":"messageBox nself",children:[Object(J.jsx)("span",{className:"messageData",children:e.data}),Object(J.jsx)("span",{className:e.origin?"messageTime rightTime":"messageTime leftTime",children:j(e.time)})]})},e.msgId)}))}()})}),Object(J.jsxs)("div",{className:"messageInput",children:[Object(J.jsx)("input",{type:"text",className:"messageInputText",name:"messageInputText",id:"messageInputText",placeholder:"Type a message...",value:p,onInput:b,onKeyPress:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.code){e.next=3;break}return e.next=3,g();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),Object(J.jsx)("div",{className:"sendBtn",onClick:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,g();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:Object(J.jsx)("svg",{width:"121",height:"121",viewBox:"0 0 121 121",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Object(J.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M54.1897 72.7493L76.6965 109.26C77.0071 109.797 77.4733 110.227 78.0334 110.494C78.5936 110.76 79.2214 110.85 79.8338 110.752C80.4556 110.682 81.0422 110.428 81.5174 110.021C81.9925 109.614 82.3343 109.073 82.4982 108.469L110.689 13.4223C110.859 12.8592 110.873 12.2603 110.729 11.6899C110.585 11.1195 110.288 10.5992 109.87 10.1849C109.466 9.77744 108.96 9.48701 108.404 9.34449C107.849 9.20198 107.265 9.21273 106.715 9.37558L11.5495 37.2113C10.948 37.3797 10.4101 37.7227 10.0038 38.197C9.59746 38.6714 9.34103 39.2556 9.26696 39.8757C9.17021 40.4973 9.25929 41.1336 9.52301 41.7048C9.78673 42.2759 10.2133 42.7563 10.7492 43.0858L47.6786 66.1746L80.3158 33.201C81.1866 32.3779 82.3431 31.9255 83.5412 31.939C84.7393 31.9526 85.8853 32.4311 86.7372 33.2736C87.5892 34.1161 88.0805 35.2567 88.1073 36.4546C88.1342 37.6525 87.6947 38.814 86.8814 39.6939L54.1897 72.7493ZM79.3609 120.036C77.2446 120.039 75.1633 119.496 73.3185 118.459C71.4736 117.422 69.9278 115.926 68.8305 114.116L44.9778 75.3683L5.85684 50.9245C3.82046 49.6472 2.19609 47.8093 1.17881 45.6313C0.161517 43.4534 -0.20544 41.0281 0.122003 38.6467C0.449447 36.2653 1.45737 34.029 3.02473 32.2064C4.59208 30.3839 6.65224 29.0525 8.95778 28.3722L104.078 0.500164C106.227 -0.128453 108.507 -0.165082 110.675 0.394143C112.844 0.953368 114.822 2.0877 116.399 3.67743C117.977 5.26715 119.096 7.25329 119.639 9.42622C120.181 11.5992 120.127 13.8783 119.482 16.0231L91.3373 111.07C90.6751 113.384 89.3487 115.454 87.5222 117.021C85.6956 118.589 83.4493 119.587 81.0614 119.891C80.4983 119.975 79.9303 120.024 79.3609 120.036V120.036Z",fill:"white"})})})]})]})})},ae=(n(133),function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).renderValidate=function(e,t){""===e?(r.usernameRef.current.classList.add("pad"),r.usernameRef.current.classList.remove("not-valid"),r.usernameRef.current.classList.remove("valid"),r.errorMessageRef.current.classList.remove("valid-msg"),r.errorMessageRef.current.classList.remove("not-valid-msg"),r.errorMessageRef.current.innerText=""):"valid"===e?(r.usernameRef.current.classList.remove("pad"),r.usernameRef.current.classList.remove("not-valid"),r.usernameRef.current.classList.add("valid"),r.errorMessageRef.current.classList.add("valid-msg"),r.errorMessageRef.current.classList.remove("not-valid-msg"),r.errorMessageRef.current.innerText=""):(r.usernameRef.current.classList.remove("pad"),r.usernameRef.current.classList.add("not-valid"),r.usernameRef.current.classList.remove("valid"),r.errorMessageRef.current.classList.remove("valid-msg"),r.errorMessageRef.current.classList.add("not-valid-msg"),r.errorMessageRef.current.innerText=t)},r.matchUsername=function(){return r.usernameRegex.test(r.state.username)},r.fetchUser=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.post("/api/v1/username",{data:{username:r.state.username}}).then((function(e){return e}));case 2:if(200===(t=e.sent).status&&200===t.data.code){e.next=5;break}return e.abrupt("return",!1);case 5:return e.abrupt("return",!t.data.available);case 6:case"end":return e.stop()}}),e)}))),r.validateUsername=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==r.state.username){e.next=4;break}return r.setState({validUsername:!1}),r.renderValidate("",""),e.abrupt("return");case 4:if(r.matchUsername()){e.next=9;break}return r.renderValidate("not-valid","username didn't match!"),r.setState({validUsername:!1}),e.abrupt("return");case 9:if(r.state.username!==r.props.user.username){e.next=13;break}return r.renderValidate("not-valid","self conversation is not allowed!"),r.setState({validUsername:!1}),e.abrupt("return");case 13:return e.next=15,r.fetchUser();case 15:if(e.sent){e.next=20;break}return r.renderValidate("not-valid","user does not exit!"),r.setState({validUsername:!1}),e.abrupt("return");case 20:r.renderValidate("valid",""),r.setState({validUsername:!0});case 22:case"end":return e.stop()}}),e)}))),r.handleInput=function(e){e.preventDefault(),r.setState({username:e.target.value.trim()}),clearTimeout(r.usernameTimeOut),r.usernameTimeOut=setTimeout((function(){r.validateUsername()}),600)},r.handleChat=function(e){e.preventDefault(),clearTimeout(r.sendBtnTimeOut),r.state.validUsername?r.sendBtnTimeOut=setTimeout(Object(l.a)(c.a.mark((function e(){var t,n,a,s,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.get("/api/v1/user/?username=".concat(r.state.username)).then((function(e){return e})).catch((function(e){console.log(e)}));case 2:if(200===(t=e.sent).status&&200===t.data.code){e.next=7;break}return r.renderValidate("not-valid","server error!"),r.setState({validUsername:!1}),e.abrupt("return");case 7:n=t.data.data,a=n.userId,s=n.name,i={username:r.state.username,userId:a,name:s,chatLog:[]},r.setState({username:"",validUsername:!1}),r.props.chatNewConversationWindow({value:!1}),r.props.newConversation({conv:i});case 12:case"end":return e.stop()}}),e)}))),600):r.renderValidate("not-valid","enter username")},r.usernameRef=a.a.createRef(),r.errorMessageRef=a.a.createRef(),r.state={username:"",validUsername:!1},r.usernameRegex=/^[a-zA-Z_][a-zA-Z0-9._]{4,30}$/i,r.matchUsername=r.matchUsername.bind(Object(p.a)(r)),r.renderValidate=r.renderValidate.bind(Object(p.a)(r)),r.fetchUser=r.fetchUser.bind(Object(p.a)(r)),r.validateUsername=r.validateUsername.bind(Object(p.a)(r)),r.handleInput=r.handleInput.bind(Object(p.a)(r)),r}return Object(f.a)(n,[{key:"render",value:function(){var e=this;return Object(J.jsx)("div",{className:"template-add-friend",children:Object(J.jsxs)("div",{className:"add-friend",children:[Object(J.jsx)("span",{className:"title",children:"New Conversation"}),Object(J.jsxs)("div",{className:"i",children:[Object(J.jsx)("input",{type:"text",name:"username",className:"f-input pad",value:this.state.username,ref:this.usernameRef,placeholder:"username",spellCheck:"false",autoCapitalize:"off",onInput:this.handleInput}),Object(J.jsx)("span",{className:"errorMessage",ref:this.errorMessageRef}),Object(J.jsxs)("div",{className:"f-control",children:[Object(J.jsx)("div",{className:"btn-close",onClick:function(t){t.preventDefault(),e.setState({username:"",validUsername:!1}),e.props.chatNewConversationWindow({value:!1})},children:"close"}),Object(J.jsx)("div",{className:"btn-chat",onClick:this.handleChat,children:"chat"})]})]})]})})}}]),n}(a.a.PureComponent)),se=Object(C.b)((function(e){return{user:e.user,UI:e.UI}}),{chatNewConversationWindow:M,newConversation:K,openConvWindow:R})(ae),ie=function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).init=r.props.init.bind(Object(p.a)(r)),r.newMessage=r.props.newMessage.bind(Object(p.a)(r)),r.state={SignalServer:new _},r}return Object(f.a)(n,[{key:"componentDidMount",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n,r,a=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.get("/api/v1/config",{headers:{cookies:{_token:T.getCookie("_token")}}}).then((function(e){return e.data})).catch((function(e){return console.log(e)}));case 2:t=e.sent,n=new F.io("/chat",{path:"/sockets",autoConnect:!0,reconnectionDelay:1e3,withCredentials:!0,forceNew:!1,reconnectionAttempts:3,query:{userId:t.data.userId}}),r=y(t.data.userId),H(t.data.userId,this.state.SignalServer).then((function(e){var s=Object(u.a)(Object(u.a)({},t.data),{},{signalProtocalManager:e,savedConv:r,socket:n});a.init(s),n.on("receive-message",function(){var t=Object(l.a)(c.a.mark((function t(n){var r,s;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.decryptMessageAsync(n.sender.userId,n.data);case 4:r=t.sent,s={data:r,type:n.type,time:n.time,origin:!1,msgId:Object(ne.a)()},a.newMessage({username:n.sender.username,msgObj:s});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())})).catch((function(e){return console.log(e)}));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(J.jsxs)("div",{className:"base",children:[this.props.UI.newConversationWindow.isOpen?Object(J.jsx)(se,{}):Object(J.jsx)(J.Fragment,{}),Object(J.jsxs)("div",{className:"template m-menu-area",children:[Object(J.jsx)("div",{className:"template-logo",children:Object(J.jsx)(z,{})}),Object(J.jsx)("div",{className:"template-options",children:Object(J.jsx)($,{})}),Object(J.jsx)("div",{className:"template-search",children:Object(J.jsx)(Q,{})}),Object(J.jsx)("div",{className:"template-users",children:Object(J.jsx)(ee,{convObjRef:this.convObjRef})}),this.props.UI.convWindow.isSelected?Object(J.jsx)("div",{className:"template-converstion",children:Object(J.jsxs)(J.Fragment,{children:[Object(J.jsx)("div",{className:"backBtn",onClick:function(t){t.preventDefault(),e.props.openConvWindow({userId:null,isSelected:!1})},children:Object(J.jsx)("svg",{width:"134",height:"120",viewBox:"0 0 134 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Object(J.jsx)("path",{d:"M39.0442 104.988C41.7605 107.438 46.1399 107.438 48.8562 104.988L94.9225 63.4375C97.0844 61.4875 97.0844 58.3375 94.9225 56.3875L48.8562 14.8375C46.1399 12.3875 41.7605 12.3875 39.0442 14.8375C36.3279 17.2875 36.3279 21.2375 39.0442 23.6875L79.179 59.9375L38.9888 96.1875C36.3279 98.5875 36.3279 102.588 39.0442 104.988V104.988Z",fill:"white"})})}),Object(J.jsx)(re,{})]})}):Object(J.jsx)(J.Fragment,{})]})]})}}]),n}(a.a.PureComponent),oe=Object(C.b)((function(e){return{user:e.user,UI:e.UI}}),{init:I,newMessage:S,openConvWindow:R})(ie),ce=n(9),ue=n(26),le=Object(ce.b)({user:P,UI:B,middleware:[ue.a]}),de=Object(ce.d)(le,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());i.a.render(Object(J.jsx)(C.a,{store:de,children:Object(J.jsx)(oe,{})}),document.getElementById("root"))},72:function(e,t,n){},73:function(e,t,n){}},[[134,1,2]]]);
//# sourceMappingURL=main.e0e53ca0.chunk.js.map