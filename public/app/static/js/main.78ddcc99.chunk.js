(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{126:function(e,t,n){},128:function(e,t,n){},129:function(e,t,n){},130:function(e,t,n){},131:function(e,t,n){},132:function(e,t,n){},133:function(e,t,n){},134:function(e,t,n){"use strict";n.r(t);var r=n(1),s=n.n(r),a=n(28),i=n.n(a),o=n(2),c=n.n(o),u=n(18),l=n(3),d=n(4),f=n(5),p=n(11),v=n(7),h=n(8),C=(n(72),n(73),n(6)),m=n(63),g=n(33),j=n(32),b=function(e){if(!e)return" ";if(e<new Date(0))return" ";var t=new Date(Date.now()),n=new Date(e);return n.getTime()-t.getTime()<864e5?n.toLocaleTimeString().slice(0,-3):n.toLocaleDateString()},y=function(e){var t=localStorage.getItem(String(e));return t?JSON.parse(t)[0]:[]},w=function(e,t){e&&t&&(localStorage.removeItem(String(e)),localStorage.setItem(String(e),JSON.stringify([t])))},O=n(17),x=n.n(O),I=Object(j.a)({name:"user",initialState:{userId:null,username:"",name:"",profilePicture:"/static/assets/images/profile.svg",conversation:[],signalProtocalManager:null,socket:null},reducers:{init:function(e,t){var n=t.payload;e.userId=n.userId,e.username=n.username,e.name=n.name,e.conversation=n.savedConv,e.signalProtocalManager=n.signalProtocalManager,e.socket=n.socket},updateName:function(e,t){e.name=t.payload.name},updateProfilePicture:function(e,t){e.profilePicture=t.payload.profilePicture},newConversation:function(e,t){e.conversation=Object(m.a)(Array,Object(g.a)(e.conversation).concat([t.payload.conv]))},newMessage:function(e,t){var n=t.payload,r=n.username,s=n.msgObj,a=null;e.conversation.forEach((function(e){e.username!==r||(a=e)})),a?e.conversation=e.conversation.map((function(e){return e.username===r?(e.chatLog=[].concat(Object(g.a)(e.chatLog),[s]),e):e})):x.a.get("/api/v1/user/?username=".concat(r)).then((function(t){if(200===t.status&&200===t.data.code){var n={username:t.data.data.username,userId:t.data.data.userId,name:t.data.data.name,chatLog:[s]};e.conversation=[n].concat(Object(g.a)(e.conversation))}})).catch((function(e){console.log(e)})),w(e.userId,e.conversation)},deleteConversation:function(e,t){var n=t.payload.userId,r=e.conversation.forEach((function(e){if(e.userId!==n)return e}));e.conversation=new Array(r),w(e.userId,e.conversation)}}}),k=I.actions,K=k.init,L=(k.updateName,k.updateProfilePicture,k.newConversation),S=k.deleteConversation,P=k.newMessage,N=I.reducer,M=Object(j.a)({name:"UI",initialState:{convWindow:{isSelected:!1,selectedUserId:null},settingWindow:{isOpen:!1},newConversationWindow:{isOpen:!1}},reducers:{openConvWindow:function(e,t){var n=t.payload,r=n.userId,s=n.isSelected;r?e.convWindow={isSelected:s,selectedUserId:r}:e.convWindow.isSelected=!1},changeSettingWindow:function(e,t){var n=t.payload;e.settingWindow.isOpen="boolean"===typeof n&&n},chatNewConversationWindow:function(e,t){var n=t.payload.value;e.newConversationWindow.isOpen="boolean"===typeof n&&n}}}),R=M.actions,U=(R.changeSettingWindow,R.openConvWindow),B=R.chatNewConversationWindow,T=M.reducer,W=function(){var e=(new ArrayBuffer).__proto__;return{toString:function(e){return"string"==typeof e?e:new dcodeIO.ByteBuffer.wrap(e).toString("binary")},toArrayBuffer:function(t){if(void 0!==t){if(t===Object(t)&&t.__proto__==e)return t;if("string"!=typeof t)throw new Error("Tried to convert a non-string of type "+typeof t+" to an array buffer");return t,new dcodeIO.ByteBuffer.wrap(t,"binary").toArrayBuffer()}},isEqual:function(e,t){if(void 0===e||void 0===t)return!1;e=W.toString(e),t=W.toString(t);var n=Math.max(e.length,t.length);if(n<5)throw new Error("a/b compare too short");return e.substring(0,Math.min(n,e.length))==t.substring(0,Math.min(n,t.length))},arrayBufferToBase64:function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,s=0;s<r;s++)t+=String.fromCharCode(n[s]);return window.btoa(t)},base64ToArrayBuffer:function(e){for(var t=window.atob(e),n=t.length,r=new Uint8Array(n),s=0;s<n;s++)r[s]=t.charCodeAt(s);return r.buffer},getCookie:function(e){for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var r=t[n].trim().split("=");if(r[0]===e)return r[1]}}}}(),A=W,V=window.libsignal;function H(){this.store={}}H.prototype={Direction:{SENDING:1,RECEIVING:2},getIdentityKeyPair:function(){return Promise.resolve(this.get("identityKey"))},getLocalRegistrationId:function(){return Promise.resolve(this.get("registrationId"))},put:function(e,t){if(void 0===e||void 0===t||null===e||null===t)throw new Error("Tried to store undefined/null");this.store[e]=t},get:function(e,t){if(null===e||void 0===e)throw new Error("Tried to get value for undefined/null key");return e in this.store?this.store[e]:t},remove:function(e){if(null===e||void 0===e)throw new Error("Tried to remove value for undefined/null key");delete this.store[e]},isTrustedIdentity:function(e,t,n){if(null===e||void 0===e)throw new Error("tried to check identity key for undefined/null key");if(!(t instanceof ArrayBuffer))throw new Error("Expected identityKey to be an ArrayBuffer");var r=this.get("identityKey"+e);return void 0===r?Promise.resolve(!0):Promise.resolve(A.toString(t)===A.toString(r))},loadIdentityKey:function(e){if(null===e||void 0===e)throw new Error("Tried to get identity key for undefined/null key");return Promise.resolve(this.get("identityKey"+e))},saveIdentity:function(e,t){if(null===e||void 0===e)throw new Error("Tried to put identity key for undefined/null key");var n=new V.SignalProtocolAddress.fromString(e),r=this.get("identityKey"+n.getName());return this.put("identityKey"+n.getName(),t),r&&A.toString(t)!==A.toString(r)?Promise.resolve(!0):Promise.resolve(!1)},loadPreKey:function(e){var t=this.get("25519KeypreKey"+e);return void 0!==t&&(t={pubKey:t.pubKey,privKey:t.privKey}),Promise.resolve(t)},storePreKey:function(e,t){return Promise.resolve(this.put("25519KeypreKey"+e,t))},removePreKey:function(e){return Promise.resolve(this.remove("25519KeypreKey"+e))},loadSignedPreKey:function(e){var t=this.get("25519KeysignedKey"+e);return void 0!==t&&(t={pubKey:t.pubKey,privKey:t.privKey}),Promise.resolve(t)},storeSignedPreKey:function(e,t){return Promise.resolve(this.put("25519KeysignedKey"+e,t))},removeSignedPreKey:function(e){return Promise.resolve(this.remove("25519KeysignedKey"+e))},loadSession:function(e){return Promise.resolve(this.get("session"+e))},storeSession:function(e,t){return Promise.resolve(this.put("session"+e,t))},removeSession:function(e){return Promise.resolve(this.remove("session"+e))},removeAllSessions:function(e){for(var t in this.store)t.startsWith("session"+e)&&delete this.store[t];return Promise.resolve()},storeSessionCipher:function(e,t){this.put("cipher"+e,t)},loadSessionCipher:function(e){var t=this.get("cipher"+e);return void 0==t?null:t}};var Z=H,_=window.libsignal,E=function(){function e(){Object(d.a)(this,e),this.bundleAPI=x.a.create({baseURL:"/api/v1/bundle",headers:{cookies:{_token:A.getCookie("_token")}}})}return Object(f.a)(e,[{key:"registerNewPreKeyBundle",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=Object(u.a)({},n)).identityKey=A.arrayBufferToBase64(r.identityKey),r.preKeys=r.preKeys.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{publicKey:A.arrayBufferToBase64(e.publicKey)})})),r.signedPreKey.publicKey=A.arrayBufferToBase64(r.signedPreKey.publicKey),r.signedPreKey.signature=A.arrayBufferToBase64(r.signedPreKey.signature),e.next=7,this.postBundle(t,JSON.stringify(r));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updatePreKeyBundle",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.postBundle(t,JSON.stringify(n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getPreKeyBundle",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.getBundle(t);case 3:return e.t1=e.sent,n=e.t0.parse.call(e.t0,e.t1),(r=n.preKeys.splice(-1))[0].publicKey=A.base64ToArrayBuffer(r[0].publicKey),this.updatePreKeyBundle(t,n),e.abrupt("return",{identityKey:A.base64ToArrayBuffer(n.identityKey),registrationId:n.registrationId,signedPreKey:{keyId:n.signedPreKey.keyId,publicKey:A.base64ToArrayBuffer(n.signedPreKey.publicKey),signature:A.base64ToArrayBuffer(n.signedPreKey.signature)},preKey:r[0]});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postBundle",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bundleAPI.post("/?id=".concat(t),{bundle:n}).then((function(e){200!==e.data.code&&console.log(e.data.message)})).catch((function(e){console.log(e)}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getBundle",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bundleAPI.get("/?id=".concat(t)).then((function(e){return 200!==e.status||200!==e.data.code?{}:e.data.bundle})).catch((function(e){return console.log(e),{}}));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),D=function(){function e(t,n){Object(d.a)(this,e),this.userId=t,this.store=new Z,this.signalServerStore=n}return Object(f.a)(e,[{key:"initializeAsync",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._generateIdentityAsync();case 2:return e.next=4,this._generatePreKeyBundleAsync();case 4:t=e.sent,this.signalServerStore.registerNewPreKeyBundle(this.userId,t);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"encryptMessageAsync",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){var r,s,a,i,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(r=this.store.loadSessionCipher(t))){e.next=11;break}return s=new _.SignalProtocolAddress(t,123),a=new _.SessionBuilder(this.store,s),e.next=6,this.signalServerStore.getPreKeyBundle(t);case 6:return i=e.sent,e.next=9,a.processPreKey(i);case 9:r=new _.SessionCipher(this.store,s),this.store.storeSessionCipher(t,r);case 11:return e.next=13,r.encrypt(A.toArrayBuffer(n));case 13:return o=e.sent,e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"decryptMessageAsync",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){var r,s,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(r=this.store.loadSessionCipher(t))&&(s=new _.SignalProtocolAddress(t,123),r=new _.SessionCipher(this.store,s),this.store.storeSessionCipher(t,r)),!(3==n.type)){e.next=10;break}return e.next=6,r.decryptPreKeyWhisperMessage(n.body,"binary");case 6:return a=e.sent,e.abrupt("return",A.toString(a));case 10:return e.next=12,r.decryptWhisperMessage(n.body,"binary");case 12:return a=e.sent,e.abrupt("return",A.toString(a));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_generateIdentityAsync",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([_.KeyHelper.generateIdentityKeyPair(),_.KeyHelper.generateRegistrationId()]);case 2:t=e.sent,this.store.put("identityKey",t[0]),this.store.put("registrationId",t[1]);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_generatePreKeyBundleAsync",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n,r,s,a,i,o,u=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.store.getIdentityKeyPair(),this.store.getLocalRegistrationId()]);case 2:return t=e.sent,n=t[0],r=t[1],e.next=7,Promise.all([_.KeyHelper.generatePreKey(r+1),_.KeyHelper.generatePreKey(r+2),_.KeyHelper.generatePreKey(r+3),_.KeyHelper.generatePreKey(r+4),_.KeyHelper.generateSignedPreKey(n,r+1)]);case 7:return s=e.sent,a=[s[0],s[1],s[2],s[3]],i=s[4],a.forEach((function(e){u.store.storePreKey(e.keyId,e.keyPair)})),this.store.storeSignedPreKey(i.keyId,i.keyPair),o=a.map((function(e){return{keyId:e.keyId,publicKey:e.keyPair.pubKey}})),e.abrupt("return",{identityKey:n.pubKey,registrationId:r,preKeys:o,signedPreKey:{keyId:i.keyId,publicKey:i.keyPair.pubKey,signature:i.signature}});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function F(e,t){return J.apply(this,arguments)}function J(){return(J=Object(l.a)(c.a.mark((function e(t,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new D(t,n),e.next=3,Promise.all([r.initializeAsync()]);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var z=n(64),X=(n(126),n(0)),G=function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){return Object(X.jsx)(s.a.Fragment,{children:Object(X.jsxs)("span",{className:"logo",children:["K",Object(X.jsxs)("svg",{width:"201",height:"203",viewBox:"0 0 201 203",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(X.jsx)("path",{d:"M73.7759 81.6424C79.6796 81.6424 84.4655 76.7902 84.4655 70.8047C84.4655 64.8191 79.6796 59.9669 73.7759 59.9669C67.8722 59.9669 63.0863 64.8191 63.0863 70.8047C63.0863 76.7902 67.8722 81.6424 73.7759 81.6424Z",fill:"white"}),Object(X.jsx)("path",{d:"M74.1497 112.989C80.0534 112.989 84.8393 108.136 84.8393 102.151C84.8393 96.1653 80.0534 91.313 74.1497 91.313C68.2459 91.313 63.46 96.1653 63.46 102.151C63.46 108.136 68.2459 112.989 74.1497 112.989Z",fill:"white"}),Object(X.jsx)("path",{d:"M73.7759 144.335C79.6796 144.335 84.4655 139.482 84.4655 133.497C84.4655 127.511 79.6796 122.659 73.7759 122.659C67.8722 122.659 63.0863 127.511 63.0863 133.497C63.0863 139.482 67.8722 144.335 73.7759 144.335Z",fill:"white"}),Object(X.jsx)("path",{d:"M136.866 62.6722L136.861 62.6671C132.353 58.5919 125.439 58.9936 121.42 63.5643L94.8349 93.7948C90.8154 98.3655 91.2115 105.374 95.7198 109.45L95.7254 109.455C100.234 113.53 107.147 113.128 111.166 108.558L137.751 78.3271C141.771 73.7564 141.375 66.7474 136.866 62.6722Z",fill:"white"}),Object(X.jsx)("path",{d:"M136.444 141.723L136.45 141.718C140.987 137.676 141.434 130.67 137.448 126.07L110.406 94.8627C106.42 90.2623 99.5098 89.8092 94.9722 93.8508L94.9666 93.8558C90.429 97.8974 89.9821 104.903 93.9685 109.504L121.01 140.711C124.996 145.311 131.907 145.765 136.444 141.723Z",fill:"white"}),Object(X.jsx)("path",{d:"M162.014 164.047C149.368 176.873 133.142 185.452 115.531 188.624C97.9189 191.796 79.7714 189.407 63.5423 181.782C58.7656 179.834 27.8927 188.504 21.1948 181.721C14.497 174.938 23.0487 143.615 21.1276 138.779C14.4017 124.104 11.7738 107.839 13.5299 91.7551C15.2859 75.6709 21.3586 60.3828 31.0873 47.5539C40.816 34.7249 53.8283 24.8462 68.7087 18.9925C83.5891 13.1388 99.7679 11.534 115.485 14.3529C131.202 17.1718 145.856 24.3063 157.853 34.9805C169.85 45.6546 178.73 59.4596 183.527 74.8938C188.324 90.328 188.855 106.8 185.062 122.519C181.269 138.238 173.298 152.602 162.014 164.047V164.047Z",stroke:"white",strokeWidth:"25",strokeLinecap:"round",strokeLinejoin:"round"})]}),"NNECT"]})})}}]),n}(s.a.Component),q=(n(128),n(129),function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).getUsername=r.getUsername.bind(Object(p.a)(r)),r}return Object(f.a)(n,[{key:"getUsername",value:function(){var e=this,t="";return this.props.user.conversation.forEach((function(n){n.userId===e.props.UI.convWindow.selectedUserId&&(t=n.username)})),t}},{key:"render",value:function(){return this.props.UI.convWindow.isSelected?Object(X.jsxs)("div",{className:"user-detail user-detail-show",children:[Object(X.jsx)("img",{src:"/static/assets/images/profile.svg",alt:" "}),Object(X.jsx)("span",{children:this.getUsername()})]}):Object(X.jsx)("div",{className:"user-detail user-detail-hidden"})}}]),n}(s.a.PureComponent)),$=Object(C.b)((function(e){return{user:e.user,UI:e.UI}}),{})(q),Q=function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e=this;return Object(X.jsxs)("div",{className:"option",children:[Object(X.jsx)($,{}),Object(X.jsxs)("div",{className:"controls",children:[Object(X.jsx)("div",{className:"control-svg tab-conversation",onClick:function(t){t.preventDefault(),e.props.openConvWindow({userId:null,isSelected:!1})},children:Object(X.jsx)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Object(X.jsxs)("g",{children:[Object(X.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M28.5214 104.252C31.7989 104.252 34.8143 105.481 38.0509 106.784C49.0586 112.002 61.5574 113.16 73.3364 110.052C85.1154 106.944 95.4157 99.7705 102.415 89.8005C109.415 79.8305 112.663 67.7064 111.584 55.5728C110.506 43.4391 105.171 32.0778 96.5224 23.4984C91.7285 18.7022 86.0365 14.8975 79.7717 12.3016C73.5068 9.70579 66.7919 8.36971 60.0105 8.36971C53.229 8.36971 46.5141 9.70579 40.2492 12.3016C33.9844 14.8975 28.2924 18.7022 23.4985 23.4984C16.0361 30.9984 11.0459 40.6011 9.19757 51.0182C7.34924 61.4353 8.73114 72.1685 13.1579 81.7778C14.4607 85.006 15.7226 88.1604 15.7226 91.4296C15.7226 94.6987 14.6 97.9842 13.6167 100.885C12.7973 103.277 11.5683 106.882 12.3549 107.669C13.1415 108.455 16.7632 107.21 19.1558 106.391C22.0318 105.407 25.293 104.277 28.5214 104.252ZM59.8712 119.992C51.1873 119.998 42.6062 118.114 34.7242 114.469C32.3561 113.519 30.1438 112.626 28.5542 112.626C26.7187 112.626 24.2606 113.486 21.8843 114.305C16.968 115.944 10.9291 118.074 6.4307 113.593C1.93226 109.111 4.0217 103.056 5.68505 98.1809C6.50444 95.7802 7.32383 93.2649 7.32383 91.4296C7.32383 89.8892 6.58638 87.9228 5.44743 85.0961C0.352134 73.9481 -1.21843 61.5105 0.945705 49.446C3.10984 37.3814 8.90555 26.265 17.558 17.5828C24.5388 10.5993 33.1354 5.44655 42.5851 2.58145C52.0348 -0.283645 62.0456 -0.772484 71.7295 1.15829C81.4134 3.08907 90.4712 7.37978 98.0993 13.6498C105.727 19.9199 111.69 27.9755 115.459 37.1021C119.227 46.2288 120.685 56.1443 119.702 65.9692C118.72 75.7942 115.328 85.2249 109.827 93.4248C104.326 101.625 96.8863 108.34 88.1677 112.976C79.4491 117.612 69.7211 120.024 59.8466 120L59.8712 119.992Z",fill:"white"}),Object(X.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M82.0438 67.9064C80.5994 67.8578 79.2299 67.2515 78.223 66.2147C77.216 65.178 76.65 63.7915 76.6436 62.3463C76.6372 60.9011 77.1911 59.5096 78.1888 58.4641C79.1866 57.4185 80.5507 56.8002 81.9947 56.7388H82.0438C82.7952 56.7101 83.5445 56.8332 84.2472 57.1008C84.9498 57.3685 85.5911 57.7751 86.1329 58.2965C86.6746 58.8178 87.1055 59.4431 87.3999 60.1349C87.6943 60.8267 87.846 61.5708 87.846 62.3226C87.846 63.0744 87.6943 63.8185 87.3999 64.5103C87.1055 65.2021 86.6746 65.8274 86.1329 66.3488C85.5911 66.8701 84.9498 67.2768 84.2472 67.5444C83.5445 67.8121 82.7952 67.9352 82.0438 67.9064V67.9064Z",fill:"white"}),Object(X.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M59.6663 67.9064C58.2218 67.8578 56.8523 67.2515 55.8454 66.2148C54.8385 65.178 54.2724 63.7915 54.266 62.3463C54.2597 60.9011 54.8135 59.5097 55.8113 58.4641C56.809 57.4186 58.1731 56.8002 59.6171 56.7389H59.6663C61.1103 56.7942 62.4767 57.4067 63.4787 58.4478C64.4808 59.4889 65.0406 60.8777 65.0406 62.3227C65.0406 63.7676 64.4808 65.1564 63.4787 66.1975C62.4767 67.2386 61.1103 67.8511 59.6663 67.9064V67.9064Z",fill:"white"}),Object(X.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M37.289 67.9064C35.8445 67.8578 34.475 67.2515 33.4681 66.2148C32.4612 65.178 31.8951 63.7915 31.8887 62.3463C31.8824 60.9011 32.4362 59.5097 33.434 58.4641C34.4317 57.4186 35.7958 56.8002 37.2398 56.7389H37.289C38.7329 56.7942 40.0994 57.4067 41.1014 58.4478C42.1035 59.4889 42.6632 60.8777 42.6632 62.3227C42.6632 63.7676 42.1035 65.1564 41.1014 66.1975C40.0994 67.2386 38.7329 67.8511 37.289 67.9064Z",fill:"white"})]})})}),Object(X.jsx)("div",{className:"control-svg tab-add",onClick:function(t){t.preventDefault(),e.props.chatNewConversationWindow({value:!0})},children:Object(X.jsxs)("svg",{width:"121",height:"120",viewBox:"0 0 121 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(X.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M47.2605 84.6071C21.8784 84.6071 9.00161 89.0151 9.00161 97.6938C9.00161 106.372 21.9187 110.91 47.2605 110.91C72.6023 110.91 85.5274 106.502 85.5274 97.8229C85.5274 89.1442 72.6588 84.6071 47.2605 84.6071ZM47.2605 120C35.5705 120 0 120 0 97.6857C0 77.8095 26.9726 75.5086 47.2605 75.5086C58.9505 75.5086 94.521 75.5086 94.521 97.8229C94.521 117.707 67.5565 120 47.2605 120Z",fill:"white"}),Object(X.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M47.2605 9.09043C42.7172 9.1603 38.2939 10.5599 34.5374 13.1162C30.7808 15.6725 27.8556 19.2736 26.1233 23.4743C24.391 27.6749 23.9275 32.2911 24.7901 36.7524C25.6526 41.2136 27.8035 45.3243 30.9769 48.5764C33.0798 50.7283 35.5912 52.4387 38.3638 53.6074C41.1364 54.776 44.1144 55.3794 47.1233 55.3821L47.2847 59.9354V55.3821C53.4234 55.3821 59.3106 52.9436 63.6513 48.6029C67.992 44.2622 70.4306 38.3749 70.4306 32.2363C70.4306 26.0976 67.992 20.2104 63.6513 15.8697C59.3106 11.529 53.4234 9.09043 47.2847 9.09043H47.2605ZM47.2605 64.4806H47.0748C42.8852 64.4731 38.7393 63.6295 34.8799 61.9992C31.0205 60.3689 27.5253 57.9848 24.599 54.9865C18.6181 48.9243 15.2876 40.7361 15.3391 32.2201C15.4155 25.9266 17.3517 19.7962 20.904 14.6005C24.4563 9.40477 29.466 5.37577 35.3027 3.02048C41.1394 0.665203 47.5424 0.0888718 53.7059 1.36401C59.8694 2.63915 65.518 5.70879 69.941 10.1867C74.3641 14.6646 77.3639 20.3506 78.5629 26.5293C79.762 32.7081 79.1068 39.1034 76.6798 44.9107C74.2527 50.7179 70.1623 55.6776 64.9232 59.1656C59.684 62.6536 53.5303 64.5141 47.2363 64.5129L47.2605 64.4806Z",fill:"white"}),Object(X.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M103.224 69.2923C102.024 69.2837 100.877 68.7995 100.034 67.9458C99.1906 67.0921 98.7207 65.9388 98.7271 64.739V40.4306C98.7271 39.238 99.2009 38.0942 100.044 37.2509C100.887 36.4076 102.031 35.9338 103.224 35.9338C104.417 35.9338 105.56 36.4076 106.404 37.2509C107.247 38.0942 107.721 39.238 107.721 40.4306V64.739C107.727 65.9388 107.257 67.0921 106.414 67.9458C105.571 68.7995 104.424 69.2837 103.224 69.2923Z",fill:"white"}),Object(X.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M115.503 57.126H90.9607C89.7552 57.126 88.5991 56.6471 87.7468 55.7947C86.8944 54.9423 86.4155 53.7862 86.4155 52.5807C86.4155 51.3753 86.8944 50.2192 87.7468 49.3668C88.5991 48.5144 89.7552 48.0355 90.9607 48.0355H115.503C116.709 48.0355 117.865 48.5144 118.717 49.3668C119.57 50.2192 120.048 51.3753 120.048 52.5807C120.048 53.7862 119.57 54.9423 118.717 55.7947C117.865 56.6471 116.709 57.126 115.503 57.126V57.126Z",fill:"white"})]})}),Object(X.jsx)("div",{className:"control-svg tab-delete",onClick:function(t){t.preventDefault(),e.props.UI.isSelected&&(e.props.deleteConversation({userId:e.props.UI.selectedUserId}),e.props.openConvWindow({userId:null,isSelected:!1}))},children:Object(X.jsx)("svg",{width:"288",height:"288",viewBox:"0 0 288 288",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Object(X.jsx)("g",{id:"delete 1",children:Object(X.jsx)("g",{id:"SvgjsG1008",children:Object(X.jsxs)("g",{id:"Frame",children:[Object(X.jsx)("path",{id:"Vector",d:"M234.383 24.5117H22.9787C10.3078 24.5117 0 34.8201 0 47.491V173.108C0 185.779 10.3078 196.087 22.9787 196.087H58.6367L78.7534 230.572C79.5769 231.984 81.0889 232.853 82.7235 232.853C84.3581 232.853 85.8696 231.984 86.6936 230.572L106.81 196.087H142.702C145.24 196.087 147.297 194.029 147.297 191.491C147.297 188.953 145.24 186.895 142.702 186.895H104.171C102.536 186.895 101.024 187.764 100.2 189.176L82.7235 219.136L65.2466 189.176C64.4226 187.764 62.9106 186.895 61.2765 186.895H22.9787C15.3759 186.895 9.19125 180.711 9.19125 173.108V47.491C9.19125 39.8882 15.3759 33.7035 22.9787 33.7035H234.383C241.986 33.7035 248.17 39.8882 248.17 47.491V124.091C248.17 126.629 250.228 128.686 252.766 128.686C255.304 128.686 257.362 126.629 257.362 124.091V47.491C257.362 34.8201 247.054 24.5117 234.383 24.5117Z",fill:"white"}),Object(X.jsx)("path",{id:"Vector_2",d:"M196.084 81.1914H61.2753C58.7373 81.1914 56.6797 83.249 56.6797 85.787C56.6797 88.325 58.7373 90.3827 61.2753 90.3827H196.084C198.622 90.3827 200.68 88.325 200.68 85.787C200.68 83.2496 198.622 81.1914 196.084 81.1914ZM196.084 105.702H61.2753C58.7373 105.702 56.6797 107.76 56.6797 110.298C56.6797 112.836 58.7373 114.894 61.2753 114.894H196.084C198.622 114.894 200.68 112.836 200.68 110.298C200.68 107.76 198.622 105.702 196.084 105.702ZM134.808 130.213H61.2753C58.7373 130.213 56.6797 132.27 56.6797 134.808C56.6797 137.346 58.7373 139.404 61.2753 139.404H134.808C137.346 139.404 139.403 137.346 139.403 134.808C139.403 132.27 137.346 130.213 134.808 130.213ZM222.127 131.745C185.804 131.745 156.255 161.295 156.255 197.617C156.255 233.939 185.804 263.489 222.127 263.489C258.449 263.489 287.999 233.939 287.999 197.617C287.999 161.295 258.449 131.745 222.127 131.745ZM222.127 254.298C190.873 254.298 165.446 228.871 165.446 197.617C165.446 166.363 190.873 140.936 222.127 140.936C253.381 140.936 278.808 166.363 278.808 197.617C278.808 228.871 253.381 254.298 222.127 254.298Z",fill:"white"}),Object(X.jsx)("path",{id:"Vector_3",d:"M253.54 209.532L241.625 197.616L253.54 185.701C258.916 180.325 258.916 171.578 253.54 166.202C250.936 163.598 247.473 162.164 243.791 162.164C240.108 162.164 236.646 163.598 234.041 166.202L222.126 178.118L210.21 166.202C207.606 163.598 204.143 162.164 200.461 162.164C196.778 162.164 193.315 163.598 190.712 166.202C185.336 171.578 185.336 180.325 190.712 185.701L202.628 197.616L190.712 209.532C185.336 214.907 185.336 223.654 190.712 229.03C193.316 231.634 196.779 233.068 200.461 233.068C204.144 233.068 207.606 231.634 210.211 229.03L222.126 217.115L234.041 229.03C236.646 231.634 240.108 233.068 243.791 233.068C247.473 233.068 250.936 231.634 253.54 229.03C258.916 223.654 258.916 214.907 253.54 209.532ZM247.041 222.531C246.172 223.4 245.019 223.877 243.791 223.877C242.563 223.877 241.409 223.399 240.541 222.531L225.376 207.365C224.478 206.468 223.302 206.019 222.126 206.019C220.95 206.019 219.774 206.468 218.876 207.365L203.711 222.531C202.842 223.4 201.689 223.877 200.461 223.877C199.234 223.877 198.08 223.399 197.212 222.531C195.42 220.739 195.42 217.823 197.212 216.031L212.377 200.866C214.172 199.071 214.172 196.161 212.377 194.367L197.212 179.201C195.42 177.409 195.42 174.493 197.212 172.701C198.079 171.833 199.233 171.355 200.461 171.355C201.689 171.355 202.843 171.833 203.711 172.701L218.876 187.867C220.671 189.662 223.581 189.662 225.376 187.867L240.541 172.701C241.41 171.833 242.563 171.355 243.791 171.355C245.018 171.355 246.172 171.833 247.041 172.701C248.832 174.494 248.832 177.409 247.041 179.201L231.875 194.367C231.013 195.228 230.529 196.397 230.529 197.616C230.529 198.835 231.014 200.004 231.875 200.866L247.041 216.031C248.832 217.823 248.832 220.739 247.041 222.531Z",fill:"white"})]})})})})}),Object(X.jsx)("div",{className:"control-svg tab-logout",onClick:function(e){e.preventDefault(),window.location="logout"},children:Object(X.jsxs)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(X.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M54.4506 120H25.9001C19.0308 119.992 12.4456 117.363 7.58979 112.692C2.73401 108.021 0.00438233 101.689 0 95.0848L0 32.5699C0.0065704 25.9667 2.7369 19.6355 7.59221 14.9648C12.4475 10.2941 19.0314 7.66523 25.9001 7.65469H54.3843C61.2623 7.65258 67.8598 10.2756 72.7272 14.9474C77.5946 19.6193 80.3336 25.9577 80.3424 32.5699V37.8093C80.2932 38.8958 79.8097 39.9222 78.9926 40.6743C78.1755 41.4264 77.0879 41.8463 75.9567 41.8463C74.8254 41.8463 73.7378 41.4264 72.9207 40.6743C72.1036 39.9222 71.6201 38.8958 71.571 37.8093V32.5699C71.5688 30.4022 71.1225 28.2562 70.2576 26.2543C69.3927 24.2524 68.1262 22.4339 66.5302 20.9026C64.9343 19.3713 63.0403 18.1572 60.9563 17.3296C58.8723 16.502 56.6391 16.0771 54.3843 16.0792H25.9001C21.3549 16.0876 16.9986 17.8282 13.7862 20.9195C10.5739 24.0107 8.76749 28.2003 8.76311 32.5699V95.0848C8.76749 99.4544 10.5739 103.644 13.7862 106.735C16.9986 109.826 21.3549 111.567 25.9001 111.575H54.4506C58.9804 111.569 63.3228 109.836 66.5258 106.757C69.7289 103.678 71.5313 99.5033 71.5378 95.1485V89.8533C71.587 88.7668 72.0705 87.7405 72.8876 86.9884C73.7047 86.2362 74.7923 85.8164 75.9235 85.8164C77.0548 85.8164 78.1424 86.2362 78.9595 86.9884C79.7766 87.7405 80.2601 88.7668 80.3092 89.8533V95.1485C80.3005 101.738 77.573 108.056 72.7252 112.715C67.8774 117.374 61.3053 119.994 54.4506 120V120Z",fill:"white"}),Object(X.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M115.618 68.0436H45.2568C44.1266 67.9964 43.059 67.5315 42.2766 66.746C41.4943 65.9605 41.0576 64.9149 41.0576 63.8274C41.0576 62.7398 41.4943 61.6943 42.2766 60.9087C43.059 60.1232 44.1266 59.6583 45.2568 59.6111H115.66C116.79 59.6583 117.858 60.1232 118.64 60.9087C119.422 61.6943 119.859 62.7398 119.859 63.8274C119.859 64.9149 119.422 65.9605 118.64 66.746C117.858 67.5315 116.79 67.9964 115.66 68.0436H115.618Z",fill:"white"}),Object(X.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M98.5063 84.4228C97.6474 84.4128 96.8104 84.1607 96.099 83.6978C95.3876 83.2349 94.8332 82.5816 94.5043 81.8187C94.1754 81.0558 94.0866 80.2169 94.2488 79.4059C94.411 78.595 94.8171 77.8476 95.4169 77.2564L109.406 63.8552L95.4169 50.4381C94.6485 49.64 94.2309 48.5871 94.2516 47.4997C94.2723 46.4124 94.7297 45.3749 95.528 44.6043C96.3263 43.8338 97.4037 43.3899 98.5346 43.3656C99.6656 43.3414 100.763 43.7386 101.596 44.4741L118.708 60.8453C119.117 61.2361 119.441 61.7007 119.663 62.2125C119.884 62.7242 119.998 63.2731 119.998 63.8273C119.998 64.3816 119.884 64.9305 119.663 65.4422C119.441 65.954 119.117 66.4186 118.708 66.8094L101.596 83.1886C101.191 83.5799 100.709 83.8903 100.179 84.1021C99.649 84.314 99.0805 84.4229 98.5063 84.4228V84.4228Z",fill:"white"})]})})]}),Object(X.jsx)("div",{className:"me-photo",children:Object(X.jsx)("img",{src:"/static/assets/images/profile.svg",height:"40px",width:"40px",alt:"profile",style:{display:"flex",margin:"auto"}})})]})}}]),n}(s.a.Component),Y=Object(C.b)((function(e){return{user:e.user,UI:e.UI}}),{deleteConversation:S,chatNewConversationWindow:B,openConvWindow:U})(Q),ee=(n(130),function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){return Object(X.jsxs)("div",{className:"search",children:[Object(X.jsx)("div",{className:"search-logo",children:Object(X.jsxs)("svg",{width:"121",height:"121",viewBox:"0 0 121 121",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(X.jsx)("circle",{cx:"50",cy:"50",r:"45",stroke:"#FFF8F8",strokeWidth:"10"}),Object(X.jsx)("rect",{x:"112.549",y:"120.785",width:"47.5392",height:"10.9338",transform:"rotate(-135 112.549 120.785)",fill:"white"})]})}),Object(X.jsx)("input",{type:"text",placeholder:"Search",onKeyPress:function(e){console.log(e)}})]})}}]),n}(s.a.Component)),te=(n(131),function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).getLastMsg=function(e){var t=e[e.length-1];return t.data.length>20?t.data.substring(.2)+"...":t.data},s.makeConversationList=function(){return s.props.user.conversation.map((function(e){return Object(X.jsxs)("li",{onClick:function(t){t.preventDefault(),s.props.openConvWindow({isSelected:!0,userId:e.userId})},children:[Object(X.jsx)("img",{src:"/static/assets/images/profile.svg",height:"40px",width:"40px",alt:"profile",className:"profile"}),Object(X.jsx)("div",{className:"name",children:e.username}),Object(X.jsx)("div",{className:"lastMsg",children:e.chatLog.length>0?s.getLastMsg(e.chatLog):""}),Object(X.jsx)("div",{className:"lastMsgTime",children:e.chatLog.length>0?b(e.chatLog[0].time):""})]},e.userId)}))},s.convList=Object(r.createRef)(),s}return Object(f.a)(n,[{key:"render",value:function(){return Object(X.jsx)(X.Fragment,{children:Object(X.jsx)("div",{className:"users",children:Object(X.jsx)("ul",{className:"users-list",children:this.makeConversationList()})})})}}]),n}(s.a.PureComponent)),ne=Object(C.b)((function(e){return{user:e.user,UI:e.UI}}),{openConvWindow:U})(te),re=n(65),se=(n(132),n(135));var ae=function(){var e=Object(C.d)((function(e){return e.user})),t=e.signalProtocalManager,n=e.socket,a=e.username,i=e.userId,o=Object(C.d)((function(e){return e.UI.convWindow})).selectedUserId,u=Object(C.d)((function(e){var t=[];return e.user.conversation.forEach((function(n){n.userId!==e.UI.convWindow.selectedUserId||(t=n)})),t})),d=Object(r.useState)(""),f=Object(re.a)(d,2),p=f[0],v=f[1],h=Object(C.c)(),m=Object(r.useRef)(null);Object(r.useEffect)((function(){m.current.scrollTop=9999999})),Object(r.useEffect)((function(){v("")}),[o]);var g=function(){var e=Object(l.a)(c.a.mark((function e(){var r,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.encryptMessageAsync(u.userId,p);case 3:r=e.sent,s={data:r,type:"msg/text",time:Date.now(),receiver:{username:u.username,userId:u.userId},sender:{username:a,userId:i}},n.emit("send-message",{_msgToSend:s},(function(e){if(e){var t={data:p,type:s.type,time:s.time,origin:!0,msgId:Object(se.a)()};h(P({username:s.receiver.username,msgObj:t})),v("")}})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),j=function(){var e=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=t.target.value.trimStart()).length<=0||n.length>256)){e.next=4;break}return v(""),e.abrupt("return");case 4:v(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(X.jsx)(s.a.Fragment,{children:Object(X.jsxs)("div",{className:"conversation",children:[Object(X.jsx)("div",{className:"messageList",children:Object(X.jsx)("ul",{className:"msgList",ref:m,children:function(){var e=u.chatLog;return!e||e.length<=0?Object(X.jsx)(X.Fragment,{}):e.map((function(e){return Object(X.jsx)("li",{className:"messageWrap",children:Object(X.jsxs)("div",{className:e.origin?"messageBox self":"messageBox nself",children:[Object(X.jsx)("span",{className:"messageData",children:e.data}),Object(X.jsx)("span",{className:e.origin?"messageTime rightTime":"messageTime leftTime",children:b(e.time)})]})},e.msgId)}))}()})}),Object(X.jsxs)("div",{className:"messageInput",children:[Object(X.jsx)("input",{type:"text",className:"messageInputText",name:"messageInputText",id:"messageInputText",placeholder:"Type a message...",value:p,onInput:j,onKeyPress:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.code){e.next=3;break}return e.next=3,g();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),Object(X.jsx)("div",{className:"sendBtn",onClick:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,g();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:Object(X.jsx)("svg",{width:"121",height:"121",viewBox:"0 0 121 121",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Object(X.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M54.1897 72.7493L76.6965 109.26C77.0071 109.797 77.4733 110.227 78.0334 110.494C78.5936 110.76 79.2214 110.85 79.8338 110.752C80.4556 110.682 81.0422 110.428 81.5174 110.021C81.9925 109.614 82.3343 109.073 82.4982 108.469L110.689 13.4223C110.859 12.8592 110.873 12.2603 110.729 11.6899C110.585 11.1195 110.288 10.5992 109.87 10.1849C109.466 9.77744 108.96 9.48701 108.404 9.34449C107.849 9.20198 107.265 9.21273 106.715 9.37558L11.5495 37.2113C10.948 37.3797 10.4101 37.7227 10.0038 38.197C9.59746 38.6714 9.34103 39.2556 9.26696 39.8757C9.17021 40.4973 9.25929 41.1336 9.52301 41.7048C9.78673 42.2759 10.2133 42.7563 10.7492 43.0858L47.6786 66.1746L80.3158 33.201C81.1866 32.3779 82.3431 31.9255 83.5412 31.939C84.7393 31.9526 85.8853 32.4311 86.7372 33.2736C87.5892 34.1161 88.0805 35.2567 88.1073 36.4546C88.1342 37.6525 87.6947 38.814 86.8814 39.6939L54.1897 72.7493ZM79.3609 120.036C77.2446 120.039 75.1633 119.496 73.3185 118.459C71.4736 117.422 69.9278 115.926 68.8305 114.116L44.9778 75.3683L5.85684 50.9245C3.82046 49.6472 2.19609 47.8093 1.17881 45.6313C0.161517 43.4534 -0.20544 41.0281 0.122003 38.6467C0.449447 36.2653 1.45737 34.029 3.02473 32.2064C4.59208 30.3839 6.65224 29.0525 8.95778 28.3722L104.078 0.500164C106.227 -0.128453 108.507 -0.165082 110.675 0.394143C112.844 0.953368 114.822 2.0877 116.399 3.67743C117.977 5.26715 119.096 7.25329 119.639 9.42622C120.181 11.5992 120.127 13.8783 119.482 16.0231L91.3373 111.07C90.6751 113.384 89.3487 115.454 87.5222 117.021C85.6956 118.589 83.4493 119.587 81.0614 119.891C80.4983 119.975 79.9303 120.024 79.3609 120.036V120.036Z",fill:"white"})})})]})]})})},ie=(n(133),function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).renderValidate=function(e,t){""===e?(r.usernameRef.current.classList.add("pad"),r.usernameRef.current.classList.remove("not-valid"),r.usernameRef.current.classList.remove("valid"),r.errorMessageRef.current.classList.remove("valid-msg"),r.errorMessageRef.current.classList.remove("not-valid-msg"),r.errorMessageRef.current.innerText=""):"valid"===e?(r.usernameRef.current.classList.remove("pad"),r.usernameRef.current.classList.remove("not-valid"),r.usernameRef.current.classList.add("valid"),r.errorMessageRef.current.classList.add("valid-msg"),r.errorMessageRef.current.classList.remove("not-valid-msg"),r.errorMessageRef.current.innerText=""):(r.usernameRef.current.classList.remove("pad"),r.usernameRef.current.classList.add("not-valid"),r.usernameRef.current.classList.remove("valid"),r.errorMessageRef.current.classList.remove("valid-msg"),r.errorMessageRef.current.classList.add("not-valid-msg"),r.errorMessageRef.current.innerText=t)},r.matchUsername=function(){return r.usernameRegex.test(r.state.username)},r.fetchUser=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.post("/api/v1/username",{data:{username:r.state.username}}).then((function(e){return e}));case 2:if(200===(t=e.sent).status&&200===t.data.code){e.next=5;break}return e.abrupt("return",!1);case 5:return e.abrupt("return",!t.data.available);case 6:case"end":return e.stop()}}),e)}))),r.validateUsername=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==r.state.username){e.next=4;break}return r.setState({validUsername:!1}),r.renderValidate("",""),e.abrupt("return");case 4:if(r.matchUsername()){e.next=9;break}return r.renderValidate("not-valid","username didn't match!"),r.setState({validUsername:!1}),e.abrupt("return");case 9:if(r.state.username!==r.props.user.username){e.next=13;break}return r.renderValidate("not-valid","self conversation is not allowed!"),r.setState({validUsername:!1}),e.abrupt("return");case 13:return e.next=15,r.fetchUser();case 15:if(e.sent){e.next=20;break}return r.renderValidate("not-valid","user does not exit!"),r.setState({validUsername:!1}),e.abrupt("return");case 20:r.renderValidate("valid",""),r.setState({validUsername:!0});case 22:case"end":return e.stop()}}),e)}))),r.handleInput=function(e){e.preventDefault(),r.setState({username:e.target.value.trim()}),clearTimeout(r.usernameTimeOut),r.usernameTimeOut=setTimeout((function(){r.validateUsername()}),600)},r.handleChat=function(e){e.preventDefault(),clearTimeout(r.sendBtnTimeOut),r.state.validUsername?r.sendBtnTimeOut=setTimeout(Object(l.a)(c.a.mark((function e(){var t,n,s,a,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.get("/api/v1/user/?username=".concat(r.state.username)).then((function(e){return e})).catch((function(e){console.log(e)}));case 2:if(200===(t=e.sent).status&&200===t.data.code){e.next=7;break}return r.renderValidate("not-valid","server error!"),r.setState({validUsername:!1}),e.abrupt("return");case 7:n=t.data.data,s=n.userId,a=n.name,i={username:r.state.username,userId:s,name:a,chatLog:[]},r.setState({username:"",validUsername:!1}),r.props.chatNewConversationWindow({value:!1}),r.props.newConversation({conv:i});case 12:case"end":return e.stop()}}),e)}))),600):r.renderValidate("not-valid","enter username")},r.usernameRef=s.a.createRef(),r.errorMessageRef=s.a.createRef(),r.state={username:"",validUsername:!1},r.usernameRegex=/^[a-zA-Z_][a-zA-Z0-9._]{4,30}$/i,r.matchUsername=r.matchUsername.bind(Object(p.a)(r)),r.renderValidate=r.renderValidate.bind(Object(p.a)(r)),r.fetchUser=r.fetchUser.bind(Object(p.a)(r)),r.validateUsername=r.validateUsername.bind(Object(p.a)(r)),r.handleInput=r.handleInput.bind(Object(p.a)(r)),r}return Object(f.a)(n,[{key:"render",value:function(){var e=this;return Object(X.jsx)("div",{className:"template-add-friend",children:Object(X.jsxs)("div",{className:"add-friend",children:[Object(X.jsx)("span",{className:"title",children:"New Conversation"}),Object(X.jsxs)("div",{className:"i",children:[Object(X.jsx)("input",{type:"text",name:"username",className:"f-input pad",value:this.state.username,ref:this.usernameRef,placeholder:"username",spellCheck:"false",autoCapitalize:"off",onInput:this.handleInput}),Object(X.jsx)("span",{className:"errorMessage",ref:this.errorMessageRef}),Object(X.jsxs)("div",{className:"f-control",children:[Object(X.jsx)("div",{className:"btn-close",onClick:function(t){t.preventDefault(),e.setState({username:"",validUsername:!1}),e.props.chatNewConversationWindow({value:!1})},children:"close"}),Object(X.jsx)("div",{className:"btn-chat",onClick:this.handleChat,children:"chat"})]})]})]})})}}]),n}(s.a.PureComponent)),oe=Object(C.b)((function(e){return{user:e.user,UI:e.UI}}),{chatNewConversationWindow:B,newConversation:L,openConvWindow:U})(ie),ce=function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).init=r.props.init.bind(Object(p.a)(r)),r.newMessage=r.props.newMessage.bind(Object(p.a)(r)),r.state={SignalServer:new E},r}return Object(f.a)(n,[{key:"componentDidMount",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n,r,s=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.get("/api/v1/config",{headers:{cookies:{_token:A.getCookie("_token")}}}).then((function(e){return e.data})).catch((function(e){return console.log(e)}));case 2:t=e.sent,n=new z.io("/chat",{path:"/sockets",autoConnect:!0,reconnectionDelay:1e3,withCredentials:!0,forceNew:!1,reconnectionAttempts:3,query:{userId:t.data.userId}}),r=y(t.data.userId),F(t.data.userId,this.state.SignalServer).then((function(e){var a=Object(u.a)(Object(u.a)({},t.data),{},{signalProtocalManager:e,savedConv:r,socket:n});s.init(a),n.on("receive-message",function(){var t=Object(l.a)(c.a.mark((function t(n){var r,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.decryptMessageAsync(n.sender.userId,n.data);case 4:r=t.sent,a={data:r,type:n.type,time:n.time,origin:!1,msgId:Object(se.a)()},s.newMessage({username:n.sender.username,msgObj:a});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())})).catch((function(e){return console.log(e)}));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(X.jsxs)("div",{className:"base",children:[this.props.UI.newConversationWindow.isOpen?Object(X.jsx)(oe,{}):Object(X.jsx)(X.Fragment,{}),Object(X.jsxs)("div",{className:"template m-menu-area",children:[Object(X.jsx)("div",{className:"template-logo",children:Object(X.jsx)(G,{})}),Object(X.jsx)("div",{className:"template-options",children:Object(X.jsx)(Y,{})}),Object(X.jsx)("div",{className:"template-search",children:Object(X.jsx)(ee,{})}),Object(X.jsx)("div",{className:"template-users",children:Object(X.jsx)(ne,{convObjRef:this.convObjRef})}),this.props.UI.convWindow.isSelected?Object(X.jsx)("div",{className:"template-converstion",children:Object(X.jsxs)(X.Fragment,{children:[Object(X.jsx)("div",{className:"backBtn",onClick:function(t){t.preventDefault(),e.props.openConvWindow({userId:null,isSelected:!1})},children:Object(X.jsx)("svg",{width:"134",height:"120",viewBox:"0 0 134 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Object(X.jsx)("path",{d:"M39.0442 104.988C41.7605 107.438 46.1399 107.438 48.8562 104.988L94.9225 63.4375C97.0844 61.4875 97.0844 58.3375 94.9225 56.3875L48.8562 14.8375C46.1399 12.3875 41.7605 12.3875 39.0442 14.8375C36.3279 17.2875 36.3279 21.2375 39.0442 23.6875L79.179 59.9375L38.9888 96.1875C36.3279 98.5875 36.3279 102.588 39.0442 104.988V104.988Z",fill:"white"})})}),Object(X.jsx)(ae,{})]})}):Object(X.jsx)(X.Fragment,{})]})]})}}]),n}(s.a.PureComponent),ue=Object(C.b)((function(e){return{user:e.user,UI:e.UI}}),{init:K,newMessage:P,openConvWindow:U})(ce),le=n(9),de=n(26),fe=Object(le.b)({user:N,UI:T,middleware:[de.a]}),pe=Object(le.d)(fe,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());i.a.render(Object(X.jsx)(C.a,{store:pe,children:Object(X.jsx)(ue,{})}),document.getElementById("root"))},72:function(e,t,n){},73:function(e,t,n){}},[[134,1,2]]]);
//# sourceMappingURL=main.78ddcc99.chunk.js.map